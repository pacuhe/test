/**
 * TWO 2D rendering engine
 * @version 
 * @link www.wimi5.com
 *        Copyright (c) 2015 WIMI5. All rights reserved.
 */
var TWO="undefined"==typeof TWO?{}:TWO;TWO.namespace=function(t){var e=t.split("."),i=TWO,r=0;"TWO"===e[0]&&(e=e.slice(1));var s=e.length;for(r=0;s>r;r+=1){var n=e[r];"undefined"==typeof i[n]&&(i[n]={}),i=i[n]}return i},function(){for(var t,e,i,r,s=0,n=["ms","moz","webkit","o"],a=0;a<n.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[n[a]+"RequestAnimationFrame"]||window[n[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[a]+"CancelAnimationFrame"]||window[n[a]+"CancelRequestAnimationFrame"];var o=function(){r(t+i)};window.requestAnimationFrame||(window.requestAnimationFrame=function(n,a){return r=n,t=Date.now(),i=Math.max(0,16-(t-s)),e=window.setTimeout(o,i),s=t+i,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){TWO.namespace("TWO"),TWO.Engine=function(t){var e=void 0,i=void 0;t||(t={}),t.container?this.htmlContainer=t.container:(this.htmlContainer=document.createElement("div"),this.htmlContainer.name="TWO_Div",this.htmlContainer.id="TWO_Div",this.htmlContainer.setAttribute("style","position:absolute;top:0px;left:0px;"),t.container=this.htmlContainer),this.renderMgr=new TWO.core.RenderManager(t),this.resourceMgr=new TWO.core.ResourceManager,Object.defineProperty(this,"scene",{get:function(){return e},set:function(t){e!==t&&(e=t,this.renderMgr.scene=e,this.viewport=this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"viewport",{get:function(){return i},set:function(t){i=t},enumerable:!0,configurable:!0})},TWO.Engine.prototype={setRenderingParams:function(t){var e=this.renderMgr._currentWidth*this.renderMgr._scaleX,i=this.renderMgr._currentHeight*this.renderMgr._scaleX;this.renderMgr._currentWidth=0,this.renderMgr._currentHeight=0,this.renderMgr._initParams(t),this.renderMgr.scene=void 0,this.renderMgr.resize(e,i),this.scene&&(this.renderMgr.scene=this.scene)},updateAndDraw:function(t,e){this.scene&&this.renderMgr&&this.viewport&&this.renderMgr.updateAndDraw(t,e,this.viewport)},loadScene:function(t,e,i){function r(e){function r(t){t?s.scene=t:console.log("WARNING, unable to create Scene"),i&&i(t)}var n=s.createElement("Scene");n.load(s,e,r,t)}var s=this;this.resourceMgr.downloadResource("scene",e,t,r)},unloadScene:function(t){t.unload()},createElement:function(t){var e=void 0;return TWO.core.renderables[t]&&(e=new TWO.core.renderables[t],e.resourceMgr=this.resourceMgr),e},resize:function(t,e){this.renderMgr.resize(t,e)},__intersectingObjs:[],getIntersectingObjects:function(t,e,i,r,s){return this.__intersectingObjs.length=0,this.scene?(s===!1&&void 0!==this.renderMgr._scaleX&&void 0!==this.renderMgr._scaleX&&(t/=this.renderMgr._scaleX,e/=this.renderMgr._scaleY),this.scene.getIntersectingObjects(t,e,i,r,this.__intersectingObjs)):this.__intersectingObjs}}}(),function(){TWO.inherits=function(t,e){var i=t.prototype,r=function(){};r.prototype=e.prototype,t.prototype=new r,e.prototype.constructor===Object.prototype.constructor&&(e.prototype.constructor=e);for(var s in i)i.hasOwnProperty(s)&&(t.prototype[s]=i[s]);t.prototype.constructor=t,t.uber=e.prototype}}(),function(){TWO.namespace("TWO.core.utils"),TWO.core.utils.extractUrlbase=function(t){var e=t.split("/");return e.pop(),e.length<1?"":e.join("/")+"/"},TWO.core.utils.extractFileName=function(t){return t.split("/").pop()},TWO.core.utils.extractExt=function(t){return t.split(".").pop()},TWO.core.utils.normalizeUrl=function(t){var e,i,r=t,s="";"http://"==r.substr(0,7)&&(s="http://",r=r.substring(7,r.length));var n=r.split("/");for(r="",e=n.length;e>0;)i=n.pop(),""!=i&&(r=""==r?i:i+"/"+r),e--,0==e&&"/"==t[0]&&(r="/"+r);return s+r},TWO.core.utils.generateGUID=function(){var t=0,e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t=e()+e()+e()+e()},TWO.core.utils.computePowerOfTwo=function(t){for(var e=2;t>e;)e*=2;return e}}(),function(){TWO.namespace("TWO.core"),TWO.core.ResourceManager=function(){this.resources={},this.resourcesByUrl={}},TWO.core.ResourceManager.prototype={downloadResource:function(t,e,i,r){var s=this,n=function(e){var r=void 0,s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onload=function(e){if(200==s.status||0==s.status)switch(t){case"scene":case"layer":r=JSON.parse(s.response);break;default:r=s.response}else console.error(s.status+" "+s.response);a(r)},s.send(null)},a=function(n){if(n&&(s.resourcesByUrl[i]=n,s.resources[t]||(s.resources[t]={}),s.resources[t][e]={url:i,res:s.resourcesByUrl[i]}),!r)throw"callback must me provided for loading resource";r(n,e)};if(this.resourcesByUrl[i])this.resources[t]||(this.resources[t]={}),this.resources[t][e]||(this.resources[t][e]=this.resourcesByUrl[i]),r&&r(this.resources[t][e]);else switch(t){case"image":this._loadImage(i,a);break;case"scene":case"layer":n("text")}},getResource:function(t,e){return this.resources[t]&&this.resources[t][e]?this.resources[t][e].res:void 0},getResourceUrl:function(t,e){return this.resources[t]&&this.resources[t][e]?this.resources[t][e].url:void 0},removeResource:function(t,e){this.resources[t]&&this.resources[t][e]&&(this.resources[t][e].res=void 0,this.resourcesByUrl[this.resources[t][e].url]=void 0,this.resources[t][e].url=void 0,this.resources[t][e]=void 0)},addResource:function(t,e,i,r){var s=r||i.src;this.resources[t]||(this.resources[t]={}),this.resources[t][e]?console.warn("TWO: resource already on loaded on resourceManager"):(s&&(this.resourcesByUrl[s]=i),this.resources[t][e]={url:s,res:i})},reset:function(){for(var t in this.resources){for(var e in this.resources[t])this.resources[t][e].url=null,this.resources[t][e].res=null;delete this.resources[t]}this.resourcesByUrl={},this.resources={}},_loadImage:function(t,e){var i=void 0,r=function(t){e&&e(t)};i=new Image,i.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.width,t.height=this.height,e.clearRect(0,0,t.width,t.height),e.drawImage(this,0,0,this.width,this.height),r(t)},i.onerror=function(e){console.log("Image could not be loaded: "+t+" "+e),r(void 0)},i.src=t}}}(),function(){TWO.namespace("TWO.core.math"),TWO.core.math.Vector2=function(t,e){this.x=t||0,this.y=e||0},TWO.core.math.Vector2.prototype={set:function(t,e){this.x=t,this.y=e},copy:function(t){this.x=t.x,this.y=t.y},clone:function(){return new TWO.core.math.Vector2(this.x,this.y)},add:function(t,e){this.x=t.x+e.x,this.y=t.y+e.y},addSelf:function(t){this.x+=t.x,this.y+=t.y},sub:function(t,e){this.x=t.x-e.x,this.y=t.y-e.y},subSelf:function(t){this.x-=t.x,this.y-=t.y},multiplyScalar:function(t){this.x*=t,this.y*=t},divideScalar:function(t){t?(this.x/=t,this.y/=t):this.set(0,0)},negate:function(){this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){this.normalize().multiplyScalar(t)},equals:function(t){return t.x===this.x&&t.y===this.y}}}(),function(){TWO.namespace("TWO.core.math");var t=new TWO.core.math.Vector2;TWO.core.math.Rect=function(t,e,i,r){this.x=t||0,this.y=e||0,this.w=i||0,this.h=r||0},TWO.core.math.Rect.prototype={set:function(t,e,i,r){this.x=t,this.y=e,this.w=i,this.h=r},setPoints:function(t,e,i,r){this.x=t,this.y=e,this.w=i-t,this.h=r-e},copy:function(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h},intersects:function(t){return!(this.x>t.x+t.w||this.x+this.w<t.x||this.y>t.y+t.h||this.y+this.h<t.y)},intersectsCircle:function(t,e,i){var r=new TWO.core.math.Rect(this.x-i,this.y-i,this.w+2*i,this.h+2*i);return r.isPointInside(t,e)},closestPointToVector2:function(t,e){e.copy(t),e.x<this.x&&(e.x=this.x),e.x>this.x+this.w&&(e.x=this.x+this.w),e.y<this.y&&(e.y=this.y),e.y>this.y+this.h&&(e.y=this.y+this.h)},isPointInside:function(t,e){return t>=this.x&&t<=this.x+this.w&&e>=this.y&&e<=this.y+this.h},translate:function(t){this.x+=t.x,this.y+=t.y},union:function(e){t.set(Math.min(this.x,e.x),Math.min(this.y,e.y)),this.w=Math.max(this.x+this.w,e.x+e.w)-t.x,this.h=Math.max(this.y+this.h,e.y+e.h)-t.y,this.x=t.x,this.y=t.y}}}(),function(){TWO.namespace("TWO.core.math");var t="undefined"!=typeof Float32Array?Float32Array:Array;TWO.core.math.Matrix3=function(){this.value=new t(6),this.value=[1,0,0,0,1,0]},TWO.core.math.Matrix3.prototype={set:function(t,e,i,r,s,n){var a=this.value;a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=s,a[5]=n},copy:function(t){var e=this.value,i=t.value,r=5;do e[r]=i[r];while(r--)},identity:function(){var t=this.value;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0},makeRotate:function(t){var e=this.value,i=Math.sin(t),r=Math.cos(t);e[0]=r,e[1]=-i,e[2]=0,e[3]=i,e[4]=r,e[5]=0},rotate:function(t){var e,i,r,s,n=this.value,a=Math.sin(t),o=Math.cos(t);e=n[0]*o+n[1]*a,i=n[0]*-a+n[1]*o,r=n[3]*o+n[4]*a,s=n[3]*-a+n[4]*o,n[0]=e,n[1]=i,n[3]=r,n[4]=s},makeScale:function(t,e){var i=this.value;i[0]=t,i[1]=0,i[2]=0,i[3]=0,i[4]=e,i[5]=0},scale:function(t,e){var i=this.value;i[0]*=t,i[1]*=e,i[3]*=t,i[4]*=e},makeTranslate:function(t,e){var i=this.value;i[0]=1,i[1]=0,i[2]=t,i[3]=0,i[4]=1,i[5]=e},translate:function(t,e){this.value[2]+=t,this.value[5]+=e},multiply:function(t){var e=this.value,i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5];matVal=t.value,e[0]=i*matVal[0]+r*matVal[3],e[1]=i*matVal[1]+r*matVal[4],e[2]=i*matVal[2]+r*matVal[5]+s,e[3]=n*matVal[0]+a*matVal[3],e[4]=n*matVal[1]+a*matVal[4],e[5]=n*matVal[2]+a*matVal[5]+o},transformVector2:function(t){var e,i,r=this.value;e=t.x*r[0]+t.y*r[1]+r[2],i=t.x*r[3]+t.y*r[4]+r[5],t.x=e,t.y=i},getInverse:function(t){var e=this.value[0],i=this.value[1],r=this.value[2],s=this.value[3],n=this.value[4],a=this.value[5],o=e*n-s*i;if(0===o)return-1;var h=t.value;h[0]=n,h[1]=-i,h[2]=i*a-r*n,h[3]=-s,h[4]=e,h[5]=r*s-e*a,t.multiplyScalar(1/o)},multiplyScalar:function(t){var e=this.value,i=5;do e[i]*=t;while(i--);return this},equals:function(t){var e=t.value,i=this.value;return i[0]==e[0]&&i[1]==e[1]&&i[2]==e[2]&&i[3]==e[3]&&i[4]==e[4]&&i[5]==e[5]}}}(),function(){TWO.namespace("TWO.core.renderables");var t=new TWO.core.math.Vector2,e=new TWO.core.math.Vector2,i=new TWO.core.math.Vector2,r=new TWO.core.math.Vector2;new TWO.core.math.Matrix3;TWO.core.renderables.Object2d=function(){this.type="Object2d",this.id=void 0,this.name="",this.resourceMgr=void 0,this._x=0,this._y=0,this._w=0,this._h=0,this._rotation=0,this._scaleX=1,this._scaleY=1,this._pivotX=0,this._pivotY=0,this._alpha=1,this._anchor=new TWO.core.math.Vector2(.5,.5),this._anchorType="CENTER",this._customAnchor=!1,this._visible=!0,this._parentVisible=!0,this._dirty=!0,this._dirtyTransform=!0,this._ownerLayer=void 0,this._parent=void 0,this.boundingRect=new TWO.core.math.Rect,this.snapToPixel=!0,this.children=[],this.transform=new TWO.core.math.Matrix3,this.finalTransform=new TWO.core.math.Matrix3,this.finalAlpha=1,this.drawMatrix=new TWO.core.math.Matrix3,Object.defineProperty(this,"x",{get:function(){return this._x},set:function(t){this._x=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(t){this._y=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"w",{get:function(){return this._w},set:function(t){this._w=t,this.anchorType=this._anchorType,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"h",{get:function(){return this._h},set:function(t){this._h=t,this.anchorType=this._anchorType,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t,this.setDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"pivotX",{get:function(){return this._pivotX},set:function(t){this._pivotX=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"pivotY",{get:function(){return this._pivotY},set:function(t){this._pivotY=t,this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"visible",{get:function(){return this._visible},set:function(t){this.setVisible(t)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"dirtyTransform",{get:function(){return this._dirtyTransform},set:function(t){this.setDirtyTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(this,"dirty",{get:function(){return this._dirty},set:function(t){if(t)this.setDirty();else{this._dirty=!1;for(var e=0;e<this.children.length;e++)this.children[e].dirty=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(this,"ownerLayer",{get:function(){return this._ownerLayer},set:function(t){this.setLayer(t)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"anchorType",{get:function(){return this._anchorType},set:function(t){t!==this._anchorType&&("Object2d"==this.type&&"CUSTOM"!=t?this._anchorType="CENTER":this._anchorType=t,"TOP_LEFT"==t?this._anchor.set(0,0):"TOP_CENTER"==t?this._anchor.set(.5,0):"TOP_RIGHT"==t?this._anchor.set(1,0):"CENTER_LEFT"==t?this._anchor.set(0,.5):"CENTER"==t?this._anchor.set(.5,.5):"CENTER_RIGHT"==t?this._anchor.set(1,.5):"BOTTOM_LEFT"==t?this._anchor.set(0,1):"BOTTOM_CENTER"==t?this._anchor.set(.5,1):"BOTTOM_RIGHT"==t?this._anchor.set(1,1):"CUSTOM"==t&&(this._customAnchor=!0)),"CUSTOM"!==this._anchorType&&(this._pivotX=-this._anchor.x*this._w,this._pivotY=-this._anchor.y*this._h,this._dirtyTransform=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"anchor",{get:function(){return this._anchor},set:function(t){this._customAnchor&&(Array.isArray(t)?this._anchor.set(t[0],t[1]):this._anchor=t,this.pivotX=-this._anchor.x,this.pivotY=-this._anchor.y)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"isCustomAnchor",{get:function(){return this._customAnchor},enumerable:!0,configurable:!0})},TWO.core.renderables.Object2d.prototype={clone:function(){var t=new TWO.core.renderables[this.type];return this.cloneProperties(t),t},cloneProperties:function(t){t.resourceMgr=this.resourceMgr,t.name=this.name,t._x=this._x,t._y=this._y,t._w=this._w,t._h=this._h,t._rotation=this._rotation,t._scaleX=this._scaleX,t._scaleY=this._scaleY,t._pivotX=this._pivotX,t._pivotY=this._pivotY,t._alpha=this._alpha,t._anchor.copy(this._anchor),t._anchorType=this._anchorType,t._customAnchor=this._customAnchor,t._visible=this._visible,t._ownerLayer=this._ownerLayer,t._dirty=!0,t._dirtyTransform=!0,this._ownerLayer&&this._ownerLayer.addObject(t);for(var e,i=0;i<this.children.length;i++)e=this.children[i].clone(),t.children.push(e),e._parent=t},isVisible:function(){return this._visible&&this._parentVisible&&this._scaleX&&this._scaleY&&this.finalAlpha>0},update:function(t,e,i,r,s,n){this._updateObject2d(t,e,i,r,s,n)},_calculateTransformedBRect:function(){var s,n,a,o;t.x=i.x=this._pivotX,t.y=e.y=this._pivotY,e.x=r.x=this._w+this._pivotX,i.y=r.y=this._h+this._pivotY,this.finalTransform.transformVector2(t),this.finalTransform.transformVector2(e),this.finalTransform.transformVector2(i),this.finalTransform.transformVector2(r),s=Math.min(t.x,e.x,i.x,r.x),s=s+(0>s?-1:0)>>0,n=Math.min(t.y,e.y,i.y,r.y),n=n+(0>n?-1:0)>>0,a=Math.max(t.x,e.x,i.x,r.x),a=a+(0>a?0:1)>>0,o=Math.max(t.y,e.y,i.y,r.y),o=o+(0>o?0:1)>>0,this.boundingRect.setPoints(s,n,a,o)},_updateObject2d:function(t,e,i,r,s,n){(s||this._dirtyTransform)&&(this.transform.makeTranslate(this._x,this._y),this._rotation&&this.transform.rotate(this._rotation),this.transform.scale(this._scaleX,this._scaleY),i?(this.finalTransform.copy(i),this.finalTransform.multiply(this.transform)):this.finalTransform.copy(this.transform),this._calculateTransformedBRect(),this._dirtyTransform=!1,this._dirty=!0);var a=r*this._alpha;this.finalAlpha!==a&&(this.finalAlpha=a,this._dirty=!0),this._parentVisible=n},setVisible:function(t){t!=this._visible&&(this._visible=t,this.setDirty())},setDirtyTransform:function(){this._dirtyTransform=!0;for(var t=0;t<this.children.length;t++)this.children[t].setDirtyTransform()},setDirty:function(){this._dirty=!0;for(var t=0;t<this.children.length;t++)this.children[t].setDirty()},setLayer:function(t){if(this._ownerLayer!==t){this._ownerLayer=t,this.resourceMgr=t.resourceMgr,this._ownerLayer.objects[this.id]||this._ownerLayer.addObject(this);for(var e=0;e<this.children.length;e++)this.children[e].setLayer(t);this.dirtyTransform=!0}},appendChild:function(t){void 0!==t&&(void 0!==this._ownerLayer&&t.setLayer(this._ownerLayer),t._parent=this,t.dirtyTransform=!0,t._dirty=!0,this.children.push(t))},removeChild:function(t,e){var i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.parent=void 0),!e&&this._ownerLayer&&this._ownerLayer.removeObject(t.id),this._ownerLayer.dirty=!0},load:function(t,e,i){this.name=e.name,this.id=e.id,this._rotation=void 0==e.rotation?0:e.rotation,e.scale&&(this._scaleX=e.scale[0],this._scaleY=e.scale[1]),e.position&&(this._x=e.position[0],this._y=e.position[1]),this.snapToPixel=void 0==e.snapToPixel?!0:e.snapToPixel,this._visible=void 0==e.visible?!0:e.visible,this._alpha=void 0==e.alpha?1:e.alpha,e.anchor&&(this.anchorType=e.anchor.type,e.anchor.value&&(this.anchor=e.anchor.value)),this.dirty=!0,this.dirtyTransform=!0,i&&i(this)},unload:function(){for(var t=this.children.length-1;t>=0;t--)this.children[t].unload(),this.children.pop();this._ownerLayer&&(this._ownerLayer.removeObject(this.id),this._ownerLayer=void 0)},getIntersectingObjects:function(t,e,i,r){if(this.isVisible()&&i&&i.traverseChildren)for(var s=this.children.length-1;s>=0&&i&&(void 0===i.numObjs||r.length<i.numObjs);)this.children[s].getIntersectingObjects(t,e,i,r),s--}}}(),function(){TWO.namespace("TWO.core.renderables");var t,e=new TWO.core.math.Matrix3,i=new TWO.core.math.Matrix3,r=new TWO.core.math.Vector2,s=new TWO.core.math.Vector2,n=new TWO.core.math.Rect;TWO.core.renderables.Bitmap=function(){TWO.core.renderables.Bitmap.uber.constructor.call(this),this.type="Bitmap",this._image,this._imageId,this._offsetX=0,this._offsetY=0,this._baseOffsetX=0,this._baseOffsetY=0,this.anchorType="TOP_LEFT",Object.defineProperty(this,"image",{get:function(){return this._image},set:function(t){this._imageId=t,void 0===t?this._image=void 0:this._imageId&&this._ownerLayer&&(this._image=this.resourceMgr.getResource("image",this._ownerLayer.name+this._imageId)||this.resourceMgr.getResource("image",this._imageId),this._image&&(this._w=this._image.width,this._h=this._image.height,"CUSTOM"!==this._anchorType&&(this.pivotX=-this.anchor.x*this._w,this.pivotY=-this.anchor.y*this._h))),this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(this,"imageOffsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(this,"imageOffsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(this,"imageId",{get:function(){return this._imageId},set:function(t){this.image=t},enumerable:!0,configurable:!0})},TWO.core.renderables.Bitmap.prototype={exceptions:{IMAGE_NOT_FOUND:"Image not found",IMAGE_NOT_DEFINED:"Image not defined in scene"},cloneProperties:function(t){TWO.core.renderables.Bitmap.uber.cloneProperties.call(this,t),t._offsetX=this._offsetX,t._offsetY=this._offsetY,t._imageId=this._imageId,t._image=this._image},setLayer:function(t){this._ownerLayer!==t&&(TWO.core.renderables.Bitmap.uber.setLayer.call(this,t),!this._image&&this._imageId&&(this.image=this._imageId))},load:function(t,e,i){var r=this,s=function(){r.image||(r.image=e.image),i&&i(r)};TWO.core.renderables.Bitmap.uber.load.call(this,t,e,s)},unload:function(){this.image=void 0,TWO.core.renderables.Bitmap.uber.unload.call(this)},getIntersectingObjects:function(a,o,h,c){TWO.core.renderables.Bitmap.uber.getIntersectingObjects.call(this,a,o,h,c),(this.isVisible()||h.includeNonVisibleObjs===!0)&&h&&(void 0===h.numObjs||c.length<h.numObjs)&&(this.boundingRect.isPointInside(a,o)||h.radius)&&(n.set(0,0,this._w,this._h),e.copy(this.finalTransform),i.makeTranslate(this._pivotX,this._pivotY),e.multiply(i),-1!==e.getInverse(i)&&(r.set(a,o),i.transformVector2(r),h.radius?(n.closestPointToVector2(r,s),-1!==i.getInverse(e)&&(e.transformVector2(s),s.set(s.x-a,s.y-o),s.dot(s)<=h.radius*h.radius&&c.push(this))):n.isPointInside(r.x,r.y)&&(h.pixelPerfect&&this.image?(t=this.image.getContext("2d").getImageData(r.x+this._offsetX,r.y+this._offsetY,1,1),0!==t.data[3]&&c.push(this)):c.push(this))))}},TWO.inherits(TWO.core.renderables.Bitmap,TWO.core.renderables.Object2d)}(),function(){TWO.namespace("TWO.core.renderables"),TWO.core.renderables.Sprite=function(){TWO.core.renderables.Sprite.uber.constructor.call(this),this.type="Sprite",this.spriteDef=void 0,this._spriteDefName=void 0,this.currentAnimation,this.currentAnimationName="",this._currentAnimationFrame=0,this._startTime=void 0,this._lastTime=void 0,this._pauseTime=0,this._lastFrameDelta=0,this.paused=!0,this.revert=!1,this._loop=void 0,this.duration=0,this._fps=0,this._finishedCallback=void 0,Object.defineProperty(this,"fps",{get:function(){return this._fps},set:function(t){var e;1>t&&(t=1),e=this.revert?2*this.currentAnimation.frameNumber-this._currentAnimationFrame:this._currentAnimationFrame,this._fps=t,this._startTime&&(this._startTime=this._lastTime-(e+this._lastFrameDelta)/this._fps*1e3),this.paused&&(this._pauseTime=this._lastTime)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"loop",{get:function(){return this._loop},set:function(t){var e=this.revert?2*this.currentAnimation.frameNumber-this._currentAnimationFrame:this._currentAnimationFrame;this._loop=t,this._startTime&&(this._startTime=this._lastTime-(e+this._lastFrameDelta)/this._fps*1e3-this._lastFrameDelta),this.paused&&(this._pauseTime=this._lastTime)},enumerable:!0,configurable:!0})},TWO.core.renderables.Sprite.prototype={cloneProperties:function(t){TWO.core.renderables.Sprite.uber.cloneProperties.call(this,t),t.spriteDef=this.spriteDef,t._spriteDefName=this._spriteDefName,t.currentAnimation=this.currentAnimation,t.currentAnimationName=this.currentAnimationName,t._currentAnimationFrame=this._currentAnimationFrame,t._startTime=this._startTime,t._pauseTime=this._pauseTime,t._lastTime=this._lastTime,t.paused=this.paused,t.revert=this.revert,t._loop=this._loop,t.duration=this.duration,t._fps=this._fps},setLayer:function(t){if(this._ownerLayer!==t&&(TWO.core.renderables.Bitmap.uber.setLayer.call(this,t),this.spriteDef=this.ownerLayer.resourceMgr.getResource("spriteDef",t.name+this._spriteDefName)||this.ownerLayer.resourceMgr.getResource("spriteDef",this._spriteDefName),this.spriteDef))if(this.image=this.spriteDef.image,(void 0===this.currentAnimationName||""===this.currentAnimationName)&&(this.currentAnimationName=this.spriteDef.defaultAnimation),this.currentAnimationName&&this.spriteDef.animations){if(this.spriteDef.animations[this.currentAnimationName]){var e=0;void 0!=this.spriteDef.animations[this.currentAnimationName].fps?e=this.spriteDef.animations[this.currentAnimationName].fps:this.spriteDef.defaultFps&&(e=this.spriteDef.defaultFps);var i=void 0!=this._loop?this._loop:this.spriteDef.animations[this.currentAnimationName].loop,r=void 0!=this.revert?this.revert:this.spriteDef.animations[this.currentAnimationName].revert||!1;this.startAnimation(this.currentAnimationName,e,r,i)}}else console.warn("Warning: animation not set for sprite : "+this.name),this.w=0,this.h=0},update:function(t,e,i,r,s,n){this._updateSprite(t),this._updateObject2d(t,e,i,r,s,n)},_updateSprite:function(t){var e,i,r;this._lastTime=t,this.currentAnimation&&(this.paused?this._pauseTime||(this._pauseTime=t):this.isVisible()&&(void 0==this._startTime&&(this._startTime=t),void 0==this._loop&&(this._loop=this.currentAnimation.loop),this._pauseTime&&(this._startTime+=t-this._pauseTime,this._pauseTime=0),r=this._currentAnimationFrame,i=.001*(t-this._startTime),i>=this.currentAnimation.frameNumber/this._fps&&!this._loop?(this.paused=!0,r=this.revert?0:this.currentAnimation.frameNumber-1,this._finishedCallback&&this._finishedCallback()):(e=i*this._fps%this.currentAnimation.frameNumber,r=e>>0,this._lastFrameDelta=e-r,this.revert&&(r=this.currentAnimation.frameNumber-1-r)),r!==this._currentAnimationFrame&&(this._setAnimationFrame(r),this._dirty=!0)))},_setAnimationFrame:function(t){this._offsetX=this.currentAnimation.offset[0]+t*this.currentAnimation.frameWidth,this._offsetY=this.currentAnimation.offset[1],this._w=this.currentAnimation.frameWidth,this._h=this.currentAnimation.frameHeight,this._currentAnimationFrame=t},startAnimation:function(t,e,i,r,s){var n;return this.spriteDef&&this.spriteDef.animations&&(n=this.spriteDef.animations[t])?(this.currentAnimation=n,this.currentAnimationName=t,this._startTime=void 0,this._finishedCallback=s,void 0!=e?this._fps=e:void 0!==n.fps&&!isNaN(parseFloat(n.fps))&&isFinite(n.fps)?this._fps=n.fps:this._fps=this.spriteDef.defaultFps||0,this.paused=0===this._fps,this.revert=i||!1,this._loop=void 0!=r?r:n.loop,this._pauseTime=void 0,this._setAnimationFrame(0),"CUSTOM"!==this._anchorType&&(this._pivotX=-this._anchor.x*this._w,this._pivotY=-this._anchor.y*this._h,this._dirtyTransform=!0),!0):!1},stopAnimation:function(){this.currentAnimation&&(this.paused=!0,this._setAnimationFrame(0))},load:function(t,e,i){var r=this,s=function(){i&&i(r)};if(this._loop=e.loop,this.revert=e.revert,this._spriteDefName=e.spriteDef,this.currentAnimationName=e.currentAnimation,void 0!==this._ownerLayer&&(this.spriteDef=this.ownerLayer.resourceMgr.getResource("spriteDef",this._ownerLayer.name+this._spriteDefName),this.spriteDef)){if(this.currentAnimationName=e.currentAnimation||this.spriteDef.defaultAnimation,!this.currentAnimationName||!this.spriteDef.animations[this.currentAnimationName])throw'Animation "'+this.currentAnimationName+'"not defined for sprite "'+this.name+'"';var n=0;this.spriteDef.animations[this.currentAnimationName].fps?n=this.spriteDef.animations[this.currentAnimationName].fps:this.spriteDef.defaultFps&&(n=this.spriteDef.defaultFps);var a=void 0!=this._loop?this._loop:this.spriteDef.animations[this.currentAnimationName].loop,o=void 0!=this.revert?this.revert:this.spriteDef.animations[this.currentAnimationName].revert||!1;this.startAnimation(this.currentAnimationName,n,o,a),this.image=this.spriteDef.image}TWO.core.renderables.Sprite.uber.load.call(this,t,e,s)},unload:function(){this.spriteDef=void 0,TWO.core.renderables.Sprite.uber.unload.call(this)}},TWO.inherits(TWO.core.renderables.Sprite,TWO.core.renderables.Bitmap)}(),function(){TWO.namespace("TWO.core.renderables");var t=new TWO.core.math.Vector2,e=new TWO.core.math.Vector2,i=new TWO.core.math.Vector2,r=new TWO.core.math.Vector2,s=new TWO.core.math.Matrix3,n=new TWO.core.math.Matrix3,a=new TWO.core.math.Rect;TWO.core.renderables.Text=function(){this._font="arial",this._fontSize=10,this._text="",this._fill=!0,this._colorR=0,this._colorG=0,this._colorB=0,this._bColorR=0,this._bColorG=0,this._bColorB=0,this._borderWidth=0,TWO.core.renderables.Text.uber.constructor.call(this),this.type="Text",this._h=2*this._fontSize,this._image=document.createElement("canvas"),this._imgCtx=this._image.getContext("2d"),this._image.height=this._h,this._imgCtx.fillStyle="rgba(0, 0, 0, 0)",this._recalcSize=!0,this._dirtyText=!0,this._imageId=TWO.core.utils.generateGUID(),Object.defineProperty(this,"font",{get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._recalcSize=!0,this._dirty=!0,this._dirtyText=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.h=2*t,this._recalcSize=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"borderWidth",{get:function(){return this._borderWidth},set:function(t){this._borderWidth!==t&&(this._borderWidth=t,this._recalcSize=!0,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"fill",{get:function(){return this._fill},set:function(t){this._fill!==t&&(this._fill=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"r",{get:function(){return this._colorR},set:function(t){this._colorR!==t&&(this._colorR=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"g",{get:function(){return this._colorG},set:function(t){this._colorG!==t&&(this._colorG=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"b",{get:function(){return this._colorB},set:function(t){this.colorB!==t&&(this._colorB=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"borderR",{get:function(){return this._bColorR},set:function(t){this._bColorR!==t&&(this._bColorR=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"borderG",{get:function(){return this._bColorG},set:function(t){this._bColorG!==t&&(this._bColorG=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"borderB",{get:function(){return this._bColorB},set:function(t){this._bColorB!==t&&(this._bColorB=t,this._dirtyText=!0,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._recalcSize=!0,this._dirtyText=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"anchorType",{get:function(){return this._anchorType},set:function(t){switch(this._anchorType=t,t){case"TOP_LEFT":this._anchor.set(0,-.5);break;case"TOP_CENTER":this._anchor.set(.5,-.5);break;case"TOP_RIGHT":this._anchor.set(1,-.5);break;case"CENTER_LEFT":this._anchor.set(0,0);break;case"CENTER":this._anchor.set(.5,0);break;case"CENTER_RIGHT":this._anchor.set(1,0);break;case"BOTTOM_LEFT":this._anchor.set(0,.5);break;case"BOTTOM_CENTER":this._anchor.set(.5,.5);break;case"BOTTOM_RIGHT":this._anchor.set(1,.5);break;case"CUSTOM":this._customAnchor=!0}"CUSTOM"!==this._anchorType&&(this.pivotX=Math.round(-this._anchor.x*this._w),this.pivotY=Math.round(-(this._anchor.y+.5)*this._h),this._dirtyTransform=!0)},enumerable:!0,configurable:!0}),this.anchorType="BOTTOM_LEFT"},TWO.core.renderables.Text.prototype={_setTextProperties:function(){this._imgCtx&&(this._fill&&(this._imgCtx.fillStyle="rgb("+this._colorR+","+this._colorG+","+this._colorB+")"),this._borderWidth>0&&(this._imgCtx.strokeStyle="rgb("+this._bColorR+","+this._bColorG+","+this._bColorB+")",this._imgCtx.lineWidth=this._borderWidth),this._imgCtx.font=this.fontSize+"px "+this.font)},cloneProperties:function(t){TWO.core.renderables.Text.uber.cloneProperties.call(this,t),t._font=this._font,t._text=this._text,t._fontSize=this._fontSize,t._colorR=this._colorR,t._colorG=this._colorG,t._colorB=this._colorB,t._bColorR=this._bColorR,t._bColorG=this._bColorG,t._bColorB=this._bColorB,t._borderWidth=this._borderWidth},update:function(t,e,i,r,s,n){this._updateText(),this._updateObject2d(t,e,i,r,s,n)},_updateText:function(){var t;this._recalcSize&&(this._setTextProperties(),t=this._imgCtx.measureText(this.text).width,this._borderWidth>0&&(t+=this._borderWidth-1,this.h=2*this._fontSize+this._borderWidth-1),this._image.width!==t&&(this._image.width=t),this._image.height!==this.h&&(this._image.height=this.h),
this.w=t,this._recalcSize=!1,this._dirtyText=!0,this.anchorType=this.anchorType),this._dirtyText&&(this._imgCtx.clearRect(0,0,this.w,this.h),this._setTextProperties(),this._fill&&this._imgCtx.fillText(this._text,0,.5*this.h),this._borderWidth>0&&this._imgCtx.strokeText(this._text,0,.5*this.h))},_calculateTransformedBRect:function(){var n=.5*this._h;t.set(0,-n),e.set(this._w,-n),i.set(0,n),r.set(this._w,n),s.makeTranslate(this._pivotX,this._pivotY+.5*this._h),s.transformVector2(t),s.transformVector2(e),s.transformVector2(i),s.transformVector2(r),this.finalTransform.transformVector2(t),this.finalTransform.transformVector2(e),this.finalTransform.transformVector2(i),this.finalTransform.transformVector2(r),this.boundingRect.setPoints(Math.floor(Math.min(t.x,Math.min(e.x,Math.min(i.x,r.x))))-1,Math.floor(Math.min(t.y,Math.min(e.y,Math.min(i.y,r.y))))-1,Math.ceil(Math.max(t.x,Math.max(e.x,Math.max(i.x,r.x))))+1,Math.ceil(Math.max(t.y,Math.max(e.y,Math.max(i.y,r.y))))+1)},load:function(t,e,i){e.text&&(this._text=e.text),e.font&&(this._font=e.font),e.fontSize&&(this._fontSize=e.fontSize,this._h=2*this._fontSize),e.fill&&(this._fill=e.fill),e.color&&Array.isArray(e.color)&&3==e.color.length&&(this._colorR=e.color[0],this._colorG=e.color[1],this._colorB=e.color[2]),e.borderWidth&&(this._borderWidth=e.borderWidth),e.borderColor&&Array.isArray(e.borderColor)&&3==e.borderColor.length&&(this._bColorR=e.borderColor[0],this._bColorG=e.borderColor[1],this._bColorB=e.borderColor[2]),this._recalcSize=!0,this._updateText(),TWO.core.renderables.Text.uber.load.call(this,t,e,i)},getIntersectingObjects:function(i,r,o,h){TWO.core.renderables.Text.uber.getIntersectingObjects.call(this,i,r,o,h),((this.isVisible()||o.includeNonVisibleObjs===!0)&&o&&(void 0===o.numObjs||h.length<o.numObjs)&&this.boundingRect.isPointInside(i,r)||o.radius)&&(a.set(0,.5*-this._h,this._w,this._h),n.copy(this.finalTransform),s.makeTranslate(this._pivotX,this._pivotY+.5*this._h),n.multiply(s),-1!==n.getInverse(s)&&(t.set(i,r),s.transformVector2(t),o.radius?(a.closestPointToVector2(t,e),-1!==s.getInverse(n)&&(n.transformVector2(e),e.set(e.x-i,e.y-r),e.dot(e)<=o.radius*o.radius&&h.push(this))):a.isPointInside(t.x,t.y)&&h.push(this)))}},TWO.inherits(TWO.core.renderables.Text,TWO.core.renderables.Object2d)}(),function(){TWO.namespace("TWO.core.renderables"),TWO.core.renderables.Layer=function(){var t=this;this.type="Layer",this._ownerScene=void 0,this.name="",this.resourceMgr=void 0,this.objects={},this.id=void 0,this.children=[],this.dirty=!0,this._visible=!0,this._alpha=1,Object.defineProperty(this,"alpha",{get:function(){return t._alpha},set:function(e){0===t._alpha&&0!==e&&(t.dirty=!0),t._alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(this,"visible",{get:function(){return t._visible},set:function(e){t._visible=e,t.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(this,"ownerScene",{get:function(){return t._ownerScene},set:function(e){t.setLayer(e)},enumerable:!0,configurable:!0})},TWO.core.renderables.Layer.prototype={setScene:function(t){this._ownerScene=t},isVisible:function(){return this._visible&&this.alpha>0},appendChild:function(t){t._parent=this,t.setLayer(this),this.children.push(t)},removeChild:function(t){var e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t._parent=void 0,this.removeObject(t.id))},addObject:function(t){var e=t.id;if(!e){for(e=TWO.core.utils.generateGUID();this.objects[e];)e=TWO.core.utils.generateGUID();t.id=e}if(this.objects[e]){if(this.objects[e]!==t)throw"ID already defined in layer!: "+e}else this.objects[e]=t,t.setLayer(this);return e},removeObject:function(t,e,i){var r=this.objects[t];if(r){if(e&&r._parent&&r._parent.children.splice(r._parent.children.indexOf(r),1),!i)for(var s=0;s<r.children.length;s++)this.removeObject(r.children[s].id,e,i);r._ownerLayer=void 0,delete this.objects[t]}},load:function(t,e,i,r){var s=this,n=function(e){var n=function(){var r=0,n=function(){var r,n,a;for(var o in e.objects)if(r=e.objects[o],r&&r.children)if(n=s.objects[o])for(var h=0;h<r.children.length;h++)a=s.objects[r.children[h]],a?n.appendChild(a):console.warn("WARNING: object "+r.toString()+" not loaded correctly. Child "+r.children[h]+" not found.");else console.warn("WARNING: object "+r.toString()+" not loaded correctly");if(e.children)for(var h=0;h<e.children.length;h++)a=s.objects[e.children[h]],a?s.appendChild(a):console.warn("WARNING: layer "+e.name+" not loaded correctly. Child "+e.children[h]+" not found.");t.resourceMgr.addResource("layer",s.id,s),i&&i(s)},a=function(t){t&&s.addObject(t),r--,0==r&&n()};if(e.objects)if(r=Object.keys(e.objects).length,0!=r)for(var o in e.objects){var h=t.createElement(e.objects[o].type);h?h.load(t,e.objects[o],a):(a(),console.warn("Unable to load layer element "+o+": "+e.objects[o].toString()))}else i&&i(s)},a=function(){if(e.spriteDefs)for(var i=0;i<e.spriteDefs.length;i++)t.resourceMgr.addResource("spriteDef",e.spriteDefs[i].name,e.spriteDefs[i])},o=function(){var i=e.images?e.images.length:0,s=function(t,e){i--,t||console.warn('Could not load image "'+e+'"'),0===i&&n()};if(0!=i)for(var a=0;a<e.images.length;a++)t.resourceMgr.downloadResource("image",e.images[a].name,r+e.images[a].url,s);else n()};e?(r=void 0==r?"":r,s.name=e.name||"",s.id=e.id,s._visible=void 0!==e.visible?e.visible:!0,s._alpha=void 0!==e.alpha?e.alpha:1,a(),o()):i&&i()};this.resourceMgr=t.resourceMgr,e.url?t.resourceMgr.downloadResource("layer",e.name,r+e.url,n):n(e)},unload:function(){for(var t=this.children.length-1;t>=0;t--)this.children[t].unload(),this.children.pop();for(var e in this.objects)delete this.objects[e]},getIntersectingObjects:function(t,e,i,r){if((this.isVisible()||i.includeNonVisibleObjs===!0)&&i){var s=this.children.length-1;for(i.traverseChildren=!0;s>=0&&(void 0===i.numObjs||r.length<i.numObjs);)this.children[s].getIntersectingObjects(t,e,i,r),s--}},getById:function(t){return this.id==t?this:this.objects[t]?this.objects[t]:void 0}}}(),function(){TWO.namespace("TWO.core.renderables"),TWO.core.renderables.Scene=function(){this.type="Scene",this.name="",this.layers=[],this.resourceMgr=void 0,this.layersById={}},TWO.core.renderables.Scene.prototype={setDirty:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].dirty=!0},appendLayer:function(t){if(t.setScene(this),this.layers.push(t),t.id)this.layersById[t.id]?console.warn("Layer with the same ID already exists!: "+t.id+". Layer not created."):this.layersById[t.id]=t;else{for(var e=void 0;void 0==e||this.layersById[e];)e=TWO.core.utils.generateGUID();t.id=e,this.layersById[e]=t}},removeLayer:function(t){var e=this.layers.indexOf(this.layersById[t]);-1!=e&&(this.layers.splice(e,1),delete this.layersById[t])},load:function(t,e,i,r){var s,n=e.absoluteURLs?"":TWO.core.utils.extractUrlbase(r),a=this,o=function(){if(e.spriteDefs)for(var t=0;t<e.spriteDefs.length;t++)a.resourceMgr.addResource("spriteDef",e.spriteDefs[t].name,e.spriteDefs[t])},h=function(){var r,o=0,h=0,c={},l=function(){var t=h;return h++,function(e){if(e&&(c[t]=e),o--,0==o){for(var r=0;h>r;r++)void 0!==c[r]&&a.appendLayer(c[r]);i(a)}}};if(!e.layers)throw"Scene layers not defined!!";if(o=e.layers.length,0==o)i(a);else for(var d=0;d<e.layers.length;d++)s=e.layers[d],r=s.url?a.resourceMgr.resourcesByUrl[s.url]:a.resourceMgr.getResource("layer",s.name),r?l()(r):(r=t.createElement("Layer"),r.load(t,s,l(),n))},c=function(){var t=e.images?e.images.length:0,i=function(e,i){if(!e)throw" Could not download Image: "+i;t--,0===t&&h()};if(t)for(var r=0;r<e.images.length;r++)a.resourceMgr.downloadResource("image",e.images[r].name,n+e.images[r].url,i);else h()};this.name=e.name,this.id=e.id,this.resourceMgr=t.resourceMgr,o(),c()},unload:function(){for(var t=this.layers.length-1;t>=0;t--)this.layers.pop();this.layersById={},this.resourceMgr=void 0},getIntersectingObjects:function(t,e,i,r,s){var n;if(r||(r={}),i)if(r.traverseChildren=!1,Array.isArray(i))for(n=0;n<i.length&&(void 0===r.maxObjs||s.length<r.maxObjs);n++)i[n].ownerLayer&&this.layersById[i[n].ownerLayer.id]&&i[n].getIntersectingObjects(t,e,r,s);else i.ownerScene==this&&i.getIntersectingObjects(t,e,r,s);else for(r.traverseChildren=!0,n=this.layers.length-1;n>=0&&(void 0===r.maxObjs||s.length<r.maxObjs);)this.layers[n].getIntersectingObjects(t,e,r,s),n--;return s},getById:function(t){var e=void 0,i=0;if(this.layersById[t])return this.layersById[t];for(;!e&&i<this.layers.length;)e=this.layers[i].getById(t),i++;return e}}}(),function(){TWO.namespace("TWO.renderers");var t,e=!0,i=!1,r=.6,s=new TWO.core.math.Rect,n=new TWO.core.math.Rect,a=new TWO.core.math.Matrix3,o=new TWO.core.math.Matrix3;TWO.renderers.Canvas2dRenderer=function(t){if(this.name="Canvas2dRenderer",this.renderManager=t,this.usesSeparateCanvasLayers=!0,this._drawList=[],this._dirtyRects=[],this._dRectsPool=[],this._objsNum=0,this.zoomX=1,this.zoomY=1,e)for(var i=0;100>i;i++)this._dRectsPool.push(new TWO.core.math.Rect)},TWO.renderers.Canvas2dRenderer.prototype={init:function(t){if(e)for(var i=0;100>i;i++)this._dRectsPool.push(new TWO.core.math.Rect);return!0},createLayer:function(t){var e=document.createElement("canvas");t.ctx=e.getContext("2d"),t.ctx.imageSmoothingEnabled?t.ctx.imageSmoothingEnabled=!1:t.webkitImageSmoothingEnabled?t.ctx.webkitImageSmoothingEnabled=!1:t.ctx.mozImageSmoothingEnabled?t.ctx.mozImageSmoothingEnabled=!1:t.ctx.oImageSmoothingEnabled?t.ctx.oImageSmoothingEnabled=!1:t.ctx.msImageSmoothingEnabled&&(t.ctx.msImageSmoothingEnabled=!1),e.width=this.renderManager._currentWidth,e.height=this.renderManager._currentHeight,e.style[TWO.core.RenderManager.transformOriginPrefix]="left top",e.style.position="absolute",e.style.top=this.renderManager._offsetY+"px",e.style.left=this.renderManager._offsetX+"px",e.id="rendererCanvasDomElement."+t.layer.name,e.className="twoCanvas",t.container.appendChild(e)},__clipDRects:function(t,e){var i,r,s,n,a,o,h=this._dirtyRects;if(i=h.length,i>0){for(e.beginPath(),e.setTransform(1,0,0,1,-t.x,-t.y),r=0;i>r;)element=h[r],element.intersects(t)&&(s=element.x*this.zoomX,s=s=s+(0>s?-1:0)>>0,n=element.y*this.zoomY,n=n+(0>n?-1:0)>>0,a=element.w*this.zoomX,a=a+(0>a?0:1)>>0,o=element.h*this.zoomY,o=o+(0>o?0:1)>>0,e.rect(s,n,a,o)),r++;e.closePath(),e.clip()}},__debugDRs:function(t,e){var i,r;for(r=this._dirtyRects.length,e.setTransform(1,0,0,1,-t.x,-t.y);r--;)i=this._dirtyRects[r],e.strokeStyle="red",e.strokeRect(Math.round(i.x*this.zoomX),Math.round(i.y*this.zoomY),Math.round(i.w*this.zoomX),Math.round(i.h*this.zoomY))},updateAndDraw:function(s,n,a,o){if(s.visible){var h,c=s.layer,l=s.ctx;if(!l)return;c&&(l.save(),e&&!c.dirty?(h=this._dirtyRects,this._updateElementsDD(n,a,o,c.children,void 0,1,!1,c.visible,l),h.length>this._objsNum*r?c.dirty=!0:(t=!1,this._CheckDirtyListIntersections(c.children),this.__clipDRects(o,l))):(c.dirty=!0,this._objsNum=0,this._updateElements(n,a,c.children,void 0,1,!1,c.visible,l),t=!0),c.dirty?(l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),c.children.length&&this._drawElements(c.children,o,l,!0)):(h.length>0&&(l.clearRect(0,0,this.renderManager._currentWidth,this.renderManager._currentHeight),this._drawElements(this._drawList,o,l,!1)),i&&this.__debugDRs(o,l)),c.dirty=!1,l.restore(),this._drawList.length=0,this._objsNum=0,h&&(this._dRectsPool.concat(h),h.length=0))}},_CheckDirtyListIntersections:function(t){var e,i,r,s,a,o,h;for(i=1/this.zoomX,r=1/this.zoomY,s=t.length,a=this._dirtyRects.length,o=0;s>o;){if(e=t[o],e.isVisible()&&e.boundingRect)if(e._dirty)this._drawList.push(e);else for(h=0;a>h;){if(e.isVisible()&&e.boundingRect&&(n.set(e.boundingRect.x-i,e.boundingRect.y-r,e.boundingRect.w+2*i,e.boundingRect.h+2*r),n.intersects(this._dirtyRects[h]))){this._drawList.push(e);break}h++}this._CheckDirtyListIntersections(e.children),o++}},_setTextProperties:function(t,e){e._fill&&(t.fillStyle="rgb("+e._colorR+","+e._colorG+","+e._colorB+")"),e._borderWidth>0&&(t.strokeStyle="rgb("+e._bColorR+","+e._bColorG+","+e._bColorB+")",t.lineWidth=e._borderWidth),t.font=e.fontSize+"px "+e.font},__insertDRect:function(t){0==this._dRectsPool.length?this._dirtyRects.push(new TWO.core.math.Rect):this._dirtyRects.push(this._dRectsPool.pop()),this._dirtyRects[this._dirtyRects.length-1].copy(t)},_updateElementsDD:function(t,e,i,r,n,a,o,h,c){var l,d,u,f,_,m,p;for(_=1/this.zoomX,m=1/this.zoomY,l=r.length;l--;)this._objsNum++,d=r[l],p=d.boundingRect,p&&s.set(p.x-_,p.y-m,p.w+2*_,p.h+2*m),f=d._dirtyTransform,d.update(t,e,n,a,o,h),p&&d._dirty&&(s.intersects(p)?(s.union(p),s.intersects(i)&&this.__insertDRect(s)):(s.intersects(i)&&this.__insertDRect(s),p.intersects(i)&&this.__insertDRect(p))),d.children.length&&(u=d._visible?d.finalAlpha:0,this._updateElementsDD(t,e,i,d.children,d.finalTransform,u,f,d.isVisible(),c))},_updateElements:function(t,e,i,r,s,n,a,o){var h,c,l,d;if(i.length)for(this._objsNum+=i.length,h=0;h<i.length;h++)c=i[h],d=c._dirtyTransform,c.update(t,e,r,s,n,a),c.children.length&&(l=c._visible?c.finalAlpha:0,this._updateElements(t,e,c.children,c.finalTransform,l,d,c.isVisible(),o))},_drawEmptyImage:function(t,e,i){0>=i&&0>=e&&(e=50,i=50),t.save(),t.fillStyle="white",t.fillRect(0,0,e,i),t.strokeStyle="red",t.lineWidth=2,t.strokeRect(1,1,e-2,i-2),t.beginPath(),t.moveTo(1,1),t.lineTo(e-1,i-1),t.moveTo(e-1,1),t.lineTo(1,i-1),t.stroke(),t.restore()},_drawElements:function(t,e,i,r){var s,n,h;for(n=t.length,h=0;n>h;){if(s=t[h],"Object2d"!=s.type&&s.boundingRect.w>0&&s.boundingRect.h>0&&s.boundingRect.intersects(e)&&s.isVisible())switch(a.makeScale(this.zoomX,this.zoomY),a.translate(-e.x,-e.y),a.multiply(s.finalTransform),o.makeTranslate(s._pivotX,s._pivotY),a.multiply(o),i.globalAlpha=s.finalAlpha,i.setTransform(a.value[0],a.value[3],a.value[1],a.value[4],a.value[2],a.value[5]),s.type){case"Sprite":if(!s.currentAnimation){this._drawEmptyImage(i,s._w,s._h);break}case"Bitmap":!s._image||s._offsetX+s._w>s._image.width||s._offsetY+s._h>s._image.height?this._drawEmptyImage(i,s._w,s._h):s._w>0&&s._h>0&&i.drawImage(s._image,s._offsetX,s._offsetY,s._w,s._h,0,0,s._w,s._h);break;case"Text":s._w>0&&s._h>0&&i.drawImage(s._image,0,0),s._dirtyText=!1}r&&s.children.length&&this._drawElements(s.children,e,i,r),s._dirty=!1,s._dirtyTransform=!1,h++}},resize:function(t){t.ctx&&(t.ctx.canvas.width=this.renderManager._currentWidth,t.ctx.canvas.height=this.renderManager._currentHeight,t.ctx.canvas.style.top=this.renderManager._offsetY+"px",t.ctx.canvas.style.left=this.renderManager._offsetX+"px")},setZoom:function(t,e){this.zoomX=t,this.zoomY=e}}}(),function(){TWO.namespace("TWO.renderers.webGL");var t="precision lowp float;attribute vec2 pos;uniform vec2 resolution;attribute vec2 aTextureCoord;attribute vec4 aColor;varying vec2 vTextureCoord;varying vec4 vColor;void main() {   vec2 fpos = (pos / resolution) * 2.0 - 1.0;   gl_Position = vec4(fpos, 0.0, 1.0);   vTextureCoord = aTextureCoord;   vColor = aColor;}",e="precision lowp float;varying vec2 vTextureCoord;varying vec4 vColor;uniform sampler2D uSampler;void main() {   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor.a;}",i=void 0;TWO.renderers.webGL.Shader=function(t){i=t,this.program,this.vertexShader,this.fragmentShader,this.resolutionUniform=void 0,this.textureSamplerUniform=void 0,this.lasttexture=void 0},TWO.renderers.webGL.Shader.prototype={compileBasicShader:function(){var r;return this.program=i.createProgram(),this.vertexShader=i.createShader(i.VERTEX_SHADER),i.shaderSource(this.vertexShader,t),i.compileShader(this.vertexShader),r=i.getShaderParameter(this.vertexShader,i.COMPILE_STATUS),r?(this.fragmentShader=i.createShader(i.FRAGMENT_SHADER),i.shaderSource(this.fragmentShader,e),i.compileShader(this.fragmentShader),r=i.getShaderParameter(this.fragmentShader,i.COMPILE_STATUS),r?(i.attachShader(this.program,this.vertexShader),i.attachShader(this.program,this.fragmentShader),i.linkProgram(this.program),r=i.getProgramParameter(this.program,i.LINK_STATUS),r?i.useProgram(this.program):(console.log(i.getProgramInfoLog(this.program)),i.deleteProgram(this.program))):(console.log(i.getShaderInfoLog(this.fragmentShader)),i.deleteShader(this.fragmentShader))):(console.log(i.getShaderInfoLog(this.vertexShader)),i.deleteShader(this.vertexShader)),r},setAttribsLocation:function(){this.program.vertexPositionAttribute=i.getAttribLocation(this.program,"pos"),i.enableVertexAttribArray(this.program.vertexPositionAttribute),this.program.textureCoordAttribute=i.getAttribLocation(this.program,"aTextureCoord"),i.enableVertexAttribArray(this.program.textureCoordAttribute),this.program.colorCoordAttribute=i.getAttribLocation(this.program,"aColor"),i.enableVertexAttribArray(this.program.colorCoordAttribute),this.resolutionUniform=i.getUniformLocation(this.program,"resolution"),this.textureSamplerUniform=i.getUniformLocation(this.program,"uSampler")},setAlphaUniform:function(t){i.uniform1f(this.alphaUniform,t)},setTextureUniform:function(t){i.uniform1i(this.textureSamplerUniform,0)},setResolutionUniform:function(t,e){i.uniform2f(this.resolutionUniform,t,e)}}}(),function(){TWO.namespace("TWO.renderers.webGL"),TWO.renderers.webGL.Texture=function(){this.unit=void 0,this.glTex=void 0}}(),function(){TWO.namespace("TWO.renderers");var t,e,i,r,s,n,a,o,h,c,l,d,u,f,_,m,p,g=new TWO.core.math.Matrix3,y=new TWO.core.math.Matrix3,b=void 0,v=256,T=0;TWO.renderers.WebGlRenderer=function(t){this.name="WebGlRenderer",this.renderManager=t,this.usesSeparateCanvasLayers=!1,this.zoomX=1,this.zoomY=1,this.canvas=void 0,this.drawList=[],this.basicShader=void 0,this.vertexSize=5,this.vertexBuffer=void 0,this.vertexArray=new ArrayBuffer(4*v*4*this.vertexSize),this.positions=new Float32Array(this.vertexArray),this.colors=new Uint32Array(this.vertexArray),this.indexes=new Uint16Array(6*v);for(var e=0,i=0;6*v>e;e+=6,i+=4)this.indexes[e+0]=i+0,this.indexes[e+1]=i+1,this.indexes[e+2]=i+2,this.indexes[e+3]=i+1,this.indexes[e+4]=i+3,this.indexes[e+5]=i+2;this.glTextures={},this.textureUnits=[],this._lastIndex=0,this.unit=0,this._dirtyDrawMat=!0,this._viewportX=0,this._viewportY=0,this._preDrawMat=new TWO.core.math.Matrix3},TWO.renderers.WebGlRenderer.prototype={reset:function(){this.glTextures={},this.textureUnits=[],this._lastIndex=0},createcanvasonce:function(){this.canvas=document.createElement("canvas")},init:function(t){this.createcanvasonce(),this.createcanvasonce=function(){};try{if(b=this.canvas.getContext("experimental-webgl"),this.canvas.width=this.renderManager._currentWidth,this.canvas.height=this.renderManager._currentHeight,this.canvas.style.position="absolute",this.canvas.style.top=this.renderManager._offsetY+"px",this.canvas.style.left=this.renderManager._offsetX+"px",this.canvas.style[TWO.core.RenderManager.transformOriginPrefix]="left top",this.canvas.id="rendererWebGLDomElement",this.canvas.className="twoCanvas",this.basicShader=new TWO.renderers.webGL.Shader(b),!this.basicShader.compileBasicShader())throw"could not init basicShader";void 0!==t.maxBatchSize&&(v=t.maxBatchSize),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indexes,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.vertexArray,b.DYNAMIC_DRAW);var e=4*this.vertexSize;this.basicShader.setAttribsLocation(),b.vertexAttribPointer(this.basicShader.program.vertexPositionAttribute,2,b.FLOAT,!1,e,0),b.vertexAttribPointer(this.basicShader.program.textureCoordAttribute,2,b.FLOAT,!1,e,8),b.vertexAttribPointer(this.basicShader.program.colorCoordAttribute,4,b.UNSIGNED_BYTE,!0,e,16),p=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)-1,T=b.getParameter(b.MAX_TEXTURE_SIZE),b.disable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.enable(b.BLEND),b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA);var i=this,r=function(t){t.preventDefault(),console.log("WebGL Context Lost!")},s=function(t){i.reset(),i.init(),console.log("WebGL Context Restored!")};return this.canvas.removeEventListener("webglcontextlost",r,!1),this.canvas.removeEventListener("webglcontextrestored",s,!1),this.canvas.addEventListener("webglcontextlost",r,!1),this.canvas.addEventListener("webglcontextrestored",s,!1),this.canvas.width=Math.ceil(this.renderManager._currentWidth),this.canvas.height=Math.ceil(this.renderManager._currentHeight),this.basicShader.setResolutionUniform(this.renderManager._currentWidth,this.renderManager._currentHeight),b.viewport(0,0,this.renderManager._currentWidth,this.renderManager._currentHeight),this._dirtyDrawMat=!0,!0}catch(n){return console.log("could not create WebGL rendering context. Falling back to canvas2d... "+n),!1}},createLayer:function(t){return this.canvas&&b?(this.canvas.parentNode!==t.container&&t.container.appendChild(this.canvas),this.resize(),t.ctx=b,!0):!1},_createGlTexture:function(t,e){if(!this.glTextures[t]&&!b.isContextLost()){this.glTextures[t]=b.createTexture(),this._bindTexture(this.glTextures[t]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var i=Math.max(e.width,e.height);if(i>T){var r=T/i,s=document.createElement("canvas"),n=s.getContext("2d");s.width=e.width*r,s.height=e.height*r,n.drawImage(e,0,0,s.width,s.height),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,s)}else b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,e);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}},_removeGlTexture:function(t){this.glTextures[t]&&(!b.isContextLost(),delete this.glTextures[t])},beginUpdateAndDraw:function(){b.isContextLost()||b.clear(b.COLOR_BUFFER_BIT)},updateAndDraw:function(t,e,i,r){(r.x!==this._viewportX||r.y!==this._viewportY)&&(this._dirtyDrawMat=!0,this._viewportX=r.x,this._viewportY=r.y),this._dirtyDrawMat&&this._recalcPreDrawMat(),this.__updateElements(e,i,r,t.layer.children,void 0,t.layer.alpha,!1,t.layer.visible),this.__drawElements(),this.drawList.length=0},__updateElements:function(t,e,i,r,s,n,a,o){var h,c,l;if(r.length>0)for(h=0;h<r.length;h++)c=r[h],c.update(t,e,s,n,a,o),"Object2d"!=c.type&&c.boundingRect.intersects(i)&&c.isVisible()&&(this.drawList.push(c),this.drawList.length>=v&&this.__drawElements()),c.children.length&&(l=c._visible?c.finalAlpha:0,this.__updateElements(t,e,i,c.children,c.finalTransform,l,c._dirtyTransform,c.isVisible()))},__drawElements:function(){var p=0;d=0,u=0,f=void 0,_=void 0,b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var y=4*this.vertexSize;this.basicShader.setAttribsLocation(),b.vertexAttribPointer(this.basicShader.program.vertexPositionAttribute,2,b.FLOAT,!1,y,0),b.vertexAttribPointer(this.basicShader.program.textureCoordAttribute,2,b.FLOAT,!1,y,8),b.vertexAttribPointer(this.basicShader.program.colorCoordAttribute,4,b.UNSIGNED_BYTE,!0,y,16);for(var T=0;T<this.drawList.length;T++)if(l=this.drawList[T],void 0!==l._image&&void 0!==l._image.width){var x=1/l._image.width,w=1/l._image.height,O=.5*x,R=.5*w;(l._dirtyTransform||this._dirtyDrawMat)&&(l.drawMatrix.copy(this._preDrawMat),l.drawMatrix.multiply(l.finalTransform),g.makeTranslate(l._pivotX,l._pivotY),l.drawMatrix.multiply(g)),t=l.drawMatrix.value[0],e=l.drawMatrix.value[3],i=l.drawMatrix.value[1],r=l.drawMatrix.value[4],s=l.drawMatrix.value[2],n=l.drawMatrix.value[5],"Sprite"==l.type?(a=l._offsetX*x,h=l._offsetY*w,o=a+l._w*x,c=h+l._h*w,a+=O,h+=R,o-=O,c-=R):(a=h=0,o=c=1),l._dirty=!1,l._dirtyTransform=!1;var W=this.positions,A=this.colors,M=16777215,S=(M>>16)+(65280&M)+((255&M)<<16)+(255*l.finalAlpha<<24);W[u++]=s,W[u++]=n,W[u++]=a,W[u++]=h,A[u++]=S,W[u++]=i*l._h+s,W[u++]=r*l._h+n,W[u++]=a,W[u++]=c,A[u++]=S,W[u++]=t*l._w+s,W[u++]=e*l._w+n,W[u++]=o,W[u++]=h,A[u++]=S,W[u++]=t*l._w+i*l._h+s,W[u++]=r*l._h+e*l._w+n,W[u++]=o,W[u++]=c,A[u++]=S,d++}if(d>.5*v)b.bufferSubData(b.ARRAY_BUFFER,0,this.vertexArray);else{var E=this.positions.subarray(0,d*this.vertexSize*4);b.bufferSubData(b.ARRAY_BUFFER,0,E)}d=0,u=0;for(var T=0;T<this.drawList.length;T++)l=this.drawList[T],void 0!==l._image&&void 0!==l._image.width&&(l._dirtyText===!0&&(this._removeGlTexture(l._imageId),l._dirtyText=!1),m=this.glTextures[l._imageId],void 0===m?(void 0!==f&&(this.__flushBatch(f,d,u),u+=d,d=0),this._createGlTexture(l._imageId,l._image),f=this.glTextures[l._imageId]):(f!==m||d>=v)&&(this.__flushBatch(f,d,u),u+=d,p+=d,d=0,f!==m&&(f=m)),d++);this.__flushBatch(f,d,u),this.drawList.length=0,f=void 0},__flushBatch:function(t,e,i){0!==e&&(b.isContextLost()||(this._bindTexture(t),b.drawElements(b.TRIANGLES,6*e,b.UNSIGNED_SHORT,6*i*2)))},_recalcPreDrawMat:function(){y.makeTranslate(0,this.renderManager._currentHeight),y.scale(1,-1),this._preDrawMat.copy(y),this._preDrawMat.scale(this.zoomX,this.zoomY),this._preDrawMat.translate(-this._viewportX,this._viewportY)},_bindTexture:function(t){b.bindTexture(b.TEXTURE_2D,t)},resize:function(t){(this.renderManager._currentWidth!=this.canvas.width||this.renderManager._currentHeight!=this.canvas.height)&&(this.canvas.width=Math.ceil(this.renderManager._currentWidth),this.canvas.height=Math.ceil(this.renderManager._currentHeight),this.basicShader.setResolutionUniform(this.renderManager._currentWidth,this.renderManager._currentHeight),b.viewport(0,0,this.renderManager._currentWidth,this.renderManager._currentHeight),this._dirtyDrawMat=!0),this.canvas.style.top=this.renderManager._offsetY+"px",this.canvas.style.left=this.renderManager._offsetX+"px"},setZoom:function(t,e){this.zoomX=t,this.zoomY=e}}}(),function(){var t;TWO.namespace("TWO.core");var e="WebGlRenderer";TWO.core.RenderManager=function(t){function e(t){for(var e=document.createElement("div"),i="",r=0;r<t.length;++r){if("undefined"!=typeof e.style[t[r]]){i=t[r];break}i=null}return i}var i;if(TWO.core.RenderManager.transformPrefix=e(["transform","msTransform","mozTransform","webkitTransform","oTransform"]),TWO.core.RenderManager.transformOriginPrefix=e(["transformOrigin","mozTransformOrigin","webkitTransformOrigin","oTransformOrigin"]),TWO.core.RenderManager.devicePixelBackingRatio=window[e(["backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio"])]||1,Object.defineProperty(this,"scene",{get:function(){return i},set:function(t){if(this.reset(),i=t)for(var e=0;e<i.layers.length;e++)this._addLayer(i.layers[e],i.layers[e]._desiredLayerOrder)},enumerable:!0,configurable:!0}),!t)throw"At least a 'container' div must be set as param!";this._htmlContainer=t.container,this._layers=[],this._zoomX=1,this._zoomY=1,this.effectivePixRatio=1,this._currentWidth=window.innerWidth,this._currentHeight=window.innerHeight,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._renderer=void 0,this._initParams(t),this.resize(window.innerWidth,window.innerHeight),t.scene&&(this.scene=t.scene)},TWO.core.RenderManager.prototype={_initParams:function(t){this._aspectRatio=void 0,this.effectivePixRatio=t.doNotUseDevicePixelRatio?1:(window.devicePixelRatio||1)/TWO.core.RenderManager.devicePixelBackingRatio,t.width&&(this.initialWidth=t.width),t.height&&(this.initialHeight=t.height),this.initialWidth=this.initialWidth||window.innerWidth,this.initialHeight=this.initialHeight||window.innerHeight,this._aspectRatio=this.initialWidth/this.initialHeight,this._zoomX=t.zoomX||this._zoomX,this._zoomY=t.zoomY||this._zoomY,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,t.renderer&&TWO.renderers[t.renderer]?this._renderer&&this._renderer.name===t.renderer||this._initRenderer(t.renderer,t):this._initRenderer(void 0===this._renderer?e:this._renderer.name,t)},_initRenderer:function(t,e){(void 0===this._renderer||this._renderer.name!==t)&&(this._renderer=new TWO.renderers[t](this)),this._renderer&&(this._renderer.init(e)||(this._renderer=new TWO.renderers.Canvas2dRenderer(this),this._renderer.init(e)),void 0!==this._zoomX&&void 0!==this._zoomY&&this._renderer.setZoom(this._zoomX,this._zoomY),this.resize(this.initialWidth,this.initialHeight))},_addLayer:function(t,e){var i;i={},i.container=this._htmlContainer,i.layer=t,i.prevAlpha=t._alpha,i.visible=t.visible,this.initialWidth&&this.initialHeight?this._renderer.createLayer(i,this.initialWidth,this.initialHeight):this._renderer.createLayer(i,this._currentWidth,this._currentHeight),this._layers.push(i),(1!==this._scaleX||1!==this._scaleY)&&(i.ctx.canvas.style[TWO.core.RenderManager.transformPrefix]="scale("+this._scaleX+","+this._scaleX+")"),t.dirty=!0},updateAndDraw:function(e,i,r){if(this._renderer.usesSeparateCanvasLayers)for(t=0;t<this._layers.length;t++)currLayer=this._layers[t],1==currLayer.layer.visible?(currLayer.visible||(currLayer.visible=!0,currLayer.ctx.canvas.style.visibility="visible"),currLayer.alpha!==currLayer.layer._alpha&&(currLayer.alpha=currLayer.layer._alpha,currLayer.ctx.canvas.style.opacity=currLayer.alpha)):currLayer.visible&&(currLayer.visible=!1,currLayer.ctx.canvas.style.visibility="hidden");for(this._renderer.beginUpdateAndDraw&&this._renderer.beginUpdateAndDraw(),t=0;t<this._layers.length;t++)currLayer=this._layers[t],currLayer.layer.visible&&this._renderer.updateAndDraw(currLayer,e,i,r)},removeLayer:function(t){for(var e=void 0,i=0;!e&&i<this._layers.length;)this._layers[i].layer.layer.id==t&&(e=i),i++;void 0!==e&&(this._htmlContainer.removeChild(this._layers[e].layer.container),this._layers.splice(e,1))},reset:function(){for(t=this._layers.length-1;t>=0;t--)this._layers.pop();for(;this._htmlContainer.hasChildNodes();)this._htmlContainer.removeChild(this._htmlContainer.firstChild);this._renderer.reset&&this._renderer.reset()},resize:function(e,i){var r,s,n=e,a=i;if(e>0&&i>0){var o=e/i;o>this._aspectRatio?(a=i,n=i*this._aspectRatio):(n=e,a=e/this._aspectRatio)}for(this._offsetX=.5*(e-n)>>0,this._offsetY=.5*(i-a)>>0,n=Math.ceil(e-2*this._offsetX)*this.effectivePixRatio,a=Math.ceil(i-2*this._offsetY)*this.effectivePixRatio,n>this.initialWidth?(r=this.initialWidth,s=this.initialHeight,this._scaleX=n/(this.initialWidth*this.effectivePixRatio),this._scaleY=a/(this.initialHeight*this.effectivePixRatio),this._zoomX=this._zoomY=1):(r=n,s=a,this._scaleX=this._scaleY=1/this.effectivePixRatio,this._zoomX=n/this.initialWidth,this._zoomY=a/this.initialHeight),this._currentWidth=r,this._currentHeight=s,this._renderer.setZoom(this._zoomX,this._zoomY),t=0;t<this._layers.length;t++)this._renderer.resize(this._layers[t]),1!==this._scaleX||1!==this._scaleY?this._layers[t].ctx.canvas.style[TWO.core.RenderManager.transformPrefix]="scale("+this._scaleX+","+this._scaleY+")":this._layers[t].ctx.canvas.style[TWO.core.RenderManager.transformPrefix]="",this._layers[t].layer.dirty=!0},appendToHTMLContainer:function(t){t.appendChild(this._htmlContainer)}}}();