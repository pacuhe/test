/** Copyright (c) 2016 WIMI5. All rights reserved. */ (function(){function m(b){throw b;}var n=void 0,p=!0,s=!1,x=this;function C(b,a,g){b=b.split(".");g=g||x;!(b[0]in g)&&g.execScript&&g.execScript("var "+b[0]);for(var d;b.length&&(d=b.shift());)!b.length&&a!==n?g[d]=a:g=g[d]?g[d]:g[d]={}}Math.random();var D;
D=function(b){function a(b){var e=_.clone(Backbone.Events);a.super_.constructor.call(this,e,b);e.on=function(c,a,b){"string"!==typeof c&&m(new g(c+" must be a String",d.INVALID_TYPE));!e.isRegistered(c)&&"true"===e.config.strict&&m(new g(c+" is not registered",d.NOT_FOUND));Backbone.Events.on.call(e,c,a,b)};e.off=function(c,a){"string"!==typeof c&&m(new g(c+" must be a String",d.INVALID_TYPE));(!a||!(a instanceof Function))&&m(new g(a+" must be a defined Function",d.INVALID_DATA));!e.isRegistered(c)&&"true"===
e.config.strict&&m(new g(c+" is not registered",d.NOT_FOUND));Backbone.Events.off.call(e,c,a)};e.trigger=function(c,a){"string"!==typeof c&&m(new g(c+" must be a String",d.INVALID_TYPE));e.isRegistered(c)||m(new g(c+" is not registered",d.NOT_FOUND));Backbone.Events.trigger.call(e,c,a)};return e}var g=b.pengoError.pengoError.PengoError,d=b.pengoError.codes.codes;b.inheritance.inheritance.inherits(a,b.events.eventsManager.EventsManager);return a};C("PENGO.client.apps.igloo.plugins.igloo.eventsManager.activator");
(function(){function b(){c.off("SERVICE_REGISTERED",b);if(q=c.getService("igloo.logger")[0])k||(k=new f(e),h={functions:{on:k.on,off:k.off,emit:k.trigger,registerEvents:k.registerEvents,removeEvents:k.removeEvents,isRegistered:k.isRegistered},properties:{}}),k.setLoggerService(c.getService("igloo.logger")[0]),c.register(d,h),c.on("SERVICE_UNREGISTERED",g),c.on("SERVICE_UPDATED",r);else c.on("SERVICE_REGISTERED",b)}function a(a){k&&(k.Oa(),k.ba(n));h&&c.unregister(d,h);c.off("SERVICE_UNREGISTERED",
g);c.off("SERVICE_UPDATED",r);if(a)c.on("SERVICE_REGISTERED",b);else c.off("SERVICE_REGISTERED",b)}function g(e){switch(e){case "igloo.logger":c.getService("igloo.logger")[0]?(q=c.getService("igloo.logger")[0],k.ba(q)):a(p)}}var d="igloo.eventsManager",f,e,c,k,q,h,r=g;window.PENGO.client.apps.igloo.plugins.igloo.eventsManager.activator.activator=function(d){return{start:function(a,g){c=a;e=g.config;f||(D||m(new d.pengoError.pengoError.PengoError("'PENGO.client.apps.igloo.plugins.igloo.eventsManager.eventsManager' can't be resolved.",
d.pengoError.codes.NOT_FOUND)),f=D(d),d.require.remove.deleteByName("PENGO.client.apps.igloo.plugins.igloo.eventsManager.eventsManager"));b()},stop:a}}})();var E;
E=function(){function b(b){var f=this,e=s,c=n;this.T=function(c,a,e){window.ErrorEvent&&c instanceof window.ErrorEvent?f.D({Message:c.message,Source:c.filename,"Line number":c.lineno}):f.D({Message:c,Source:a,"Line number":e})};this.wa=function(){return e};this.D=function(a){if(e===s){if(c!==n)c.va.call(c.context||this,a);else if(b&&window.alert){var f="FATAL ERROR\n",g;for(g in a)f+="\n"+g+": "+a[g]+"\n";window.alert(f)}else{var f=document.createElement("body"),r=document.createElement("div"),w=
0;r.innerHTML="<h3>FATAL ERROR</h3>";for(g in a)r.innerHTML+="<p><span id='id"+w+"'>"+g+":</span> "+a[g]+"</p>",r.querySelector("span#id"+w).style.fontWeight="bold",w++;r.style.position="absolute";r.style.top="50%";r.style.left="50%";r.style.width="450px";r.style.height="300px";r.style.marginTop="-200px";r.style.marginLeft="-150px";r.style.font="trebuchet ms";r.style.fontSize="16px";r.querySelector("h3").style.textAlign="center";f.appendChild(r);document.body=f}e=p;this.i&&this.i.emit("FATAL_ERROR")}};
this.Ga=function(e,b){e instanceof Function?b&&("object"!==typeof b||b instanceof Array)?a.warn("Context to execute fatal errors handler, if defined, must be a function. Default handler remains."):c={va:e,context:b}:a.warn("Fatal errors handler must be a function. Default handler remains.")}}var a,g={FATAL_ERROR:"error/fatal"};b.prototype={aa:function(b){a=b},J:function(b){if(this.i!==b){if(this.i)try{this.i.removeEvents(g)}catch(f){a.warn("Error "+f+" while deregistering events when changing events manager")}(this.i=
b)&&this.i.registerEvents(g)}return this.i!==n},start:function(){window.addEventListener("error",this.T,s)},stop:function(){window.removeEventListener("error",this.T,s)}};return b};C("PENGO.client.apps.igloo.plugins.igloo.fatal.activator");
(function(){function b(){c.off("SERVICE_REGISTERED",b);q=c.getService("igloo.logger")[0];if(!q||!c.getService("igloo.eventsManager")[0])c.on("SERVICE_REGISTERED",b);else k||(k=new f(e),h={functions:{isFatal:k.wa,setHandler:k.Ga,handleFatal:k.D},properties:{}}),k.aa(q),k.J(c.getService("igloo.eventsManager")[0]),k.start(),c.register(d,h),c.on("SERVICE_UNREGISTERED",g),c.on("SERVICE_UPDATED",r)}function a(a){k&&(k.stop(),k.J(n),k.aa(n));h&&c.unregister(d,h);c.off("SERVICE_UNREGISTERED",g);c.off("SERVICE_UPDATED",
r);if(a)c.on("SERVICE_REGISTERED",b);else c.off("SERVICE_REGISTERED",b)}function g(e){switch(e){case "igloo.logger":if(c.getService("igloo.logger")[0]){q=c.getService("igloo.logger")[0];k.ba(q);return}break;case "igloo.eventsManager":if(k.J(c.getService("igloo.eventsManager")[0]))return;break;default:return}a(p)}var d="igloo.fatal",f,e,c,k,q,h,r=g;window.PENGO.client.apps.igloo.plugins.igloo.fatal.activator.activator=function(d){return{start:function(a,g,h){c=a;e=h;f||(E||m(new d.pengoError.pengoError.PengoError("'PENGO.client.apps.igloo.plugins.igloo.fatal.manager' can't be resolved.",
d.pengoError.codes.NOT_FOUND)),f=E(),d.require.remove.deleteByName("PENGO.client.apps.igloo.plugins.igloo.fatal.manager"));b()},stop:a}}})();var F;
F=function(b,a){b.add("igloo",{"pldesc#1":{msg:s,code:a.NOT_FOUND},"pldesc#2":{msg:s,code:a.INVALID_DATA},"pldesc:id#1":{msg:s,code:a.NOT_FOUND},"pldesc:id#2":{msg:s,code:a.INVALID_TYPE},"pldesc:provides#1":{msg:s,code:a.INVALID_CONFIG},"pldesc:provides#2":{msg:s,code:a.INVALID_TYPE},"pldesc:consumes#1":{msg:s,code:a.INVALID_CONFIG},"pldesc:consumes#2":{msg:s,code:a.INVALID_TYPE},"pldesc:cfg":{msg:s,code:a.INVALID_TYPE},"pldesc:activator#1":{msg:s,code:a.NOT_FOUND},"pldesc:activator#2":{msg:s,code:a.INVALID_TYPE},
"pldesc:src":{msg:s,code:a.NOT_FOUND},"pldesc:src:baseURL#1":{msg:s,code:a.NOT_FOUND},"pldesc:src:baseURL#2":{msg:s,code:a.INVALID_TYPE},"pldesc:src:js":{msg:s,code:a.NOT_FOUND},"pldesc:src:text":{msg:s,code:a.INVALID_TYPE},"pldesc:res:baseURL#1":{msg:s,code:a.NOT_FOUND},"pldesc:res:baseURL#2":{msg:s,code:a.INVALID_TYPE},"pldesc:res:template":{msg:s,code:a.INVALID_TYPE},"pldesc:lm#1":{msg:s,code:a.NOT_FOUND},"pldesc:lm#2":{msg:s,code:a.INVALID_DATA},"pldesc:lm#3":{msg:s,code:a.NOT_FOUND},"pldesc:lm#4":{msg:s,
code:a.INVALID_TYPE},"pldesc:lm#5":{msg:s,code:a.NOT_FOUND},"pldesc:lm#6":{msg:s,code:a.INVALID_TYPE},ispl:{msg:s,code:a.INVALID_TYPE},"ispl:act#1":{msg:s,code:a.INVALID_CONFIG},"ispl:act#2":{msg:s,code:a.INVALID_TYPE},"ispl:act#3":{msg:s,code:a.INVALID_CONFIG},"ispl:act#4":{msg:s,code:a.INVALID_CONFIG},"plinstall#1":{msg:s,code:a.INVALID_TYPE},"plinstall#2":{msg:s,code:a.INVALID_TYPE},"plinstall#3":{msg:s,code:a.ALREADY_SET},"plinstall#4":{msg:s,code:a.UNEXPECTED},"plinstall#5":{msg:s,code:a.UNEXPECTED},
"pluninstall#1":{msg:s,code:a.NOT_FOUND},"pluninstall#2":{msg:s,code:a.INVALID_STATE},"plstart#1":{msg:s,code:a.NOT_FOUND},"plstart#2":{msg:s,code:a.NOT_FOUND},"plstart#3":{msg:s,code:a.INVALID_STATE},"plstart#4":{msg:s,code:a.UNEXPECTED},"plstop#1":{msg:s,code:a.NOT_FOUND},"plstop#2":{msg:s,code:a.INVALID_STATE},cpl:{msg:s,code:a.UNEXPECTED},appdesc:{msg:s,code:a.UNEXPECTED},la:{msg:s,code:a.UNEXPECTED}});b.add("igloo:am",{"appdesc#1":{msg:s,code:a.NOT_FOUND}})};C("PENGO.client.igloo.require.require");
window.PENGO.client.igloo.require.require.resolve=function(b){function a(a){var e,c=p;try{if(!JSON.parse(d.enabled)||a.match(/http|s:\/\//)||a.match(/chrome-extension:\/\//))return a}catch(b){return a}d.O.forEach(function(e){a.match(e)&&(c=s)});return c?(e=a.split("?")[0],e="/"===a[0]?"/"+d.prefix+window.btoa(e.replace(/\//g,""))+"."+e.split(".").pop():d.prefix+window.btoa(e.replace(/\//g,""))+"."+e.split(".").pop(),a.split("?")[1]&&(e=e+"?"+a.split("?")[1]),e):a}var g={},d=b&&b.sto;d.O=[];d.excluded&&
d.excluded.forEach(function(a){d.O.push(RegExp(a))});d.prefix=d.prefix?d.prefix+"/":"";return{dependencies:function(a){g=a},implementation:{requireByName:function(a){a=a.split(".");var e,c;for(c in a)if(e=e===n?window[a[c]]:e[a[c]],e===n)return;return e},requireJS:function(b,e,c,d,g){var h,r;e&&(r=setTimeout(function(){h===n&&(h=s,c.call(d||this,Error("Timeout while requiring "+b)))},1E3*e));var w=document.createElement("script");w.type="text/javascript";b=a(b);w.src=g?b:b+(-1===b.indexOf("?")?"?":
"&")+"version=0.6.2";w.onload=function(){e&&clearTimeout(r);h===n&&(h=p,c.call(d||this))};w.onerror=function(){e&&clearTimeout(r);c.call(d||this,Error("Unable to load js "+b+" see console log for errors."))};document.head.appendChild(w)},requireSerieJS:function(a,e,c,b){function d(h){h?c.call(b||this,h):(a.splice(0,1),a[0]?g.require.require.requireJS(a[0],e,d):c.call(b||this))}a instanceof Array?g.require.require.requireJS(a[0],e,d):c.call(b||this,Error("'srcArray' must be an array, and it's "+typeof a))},
requireTemplate:function(b,e,c,d){var g=new XMLHttpRequest;g.overrideMimeType("text");b=a(b);d||(b=b+(-1===b.indexOf("?")?"?":"&")+"version=0.6.2");try{g.open("GET",b,p)}catch(h){e.call(c||this,h);return}g.onload=function(){for(var a={},b=g.responseText.split("@!pengoTemplate!@"),d,h=0;h<b.length;h++)d=b[h].indexOf("!@"),-1!==d&&(a[b[h].substring(b[h].indexOf("@!pengoTemplate=")+16,d)]=b[h].substring(d+2));e.call(c||this,n,a)};g.onerror=function(){e.call(c||this,Error("Error while requiring "+b))};
g.ontimeout=function(){e.call(c||this,Error("Timeout while requiring "+b))};g.send()},requireCSS:function(a,b){b||(a=a+(-1===a.indexOf("?")?"?":"&")+"version=0.6.2");if(document.createStyleSheet)document.createStyleSheet(a);else{var c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;document.querySelector("head").appendChild(c)}},requireJSON:function(b,e,c,d){var g=new XMLHttpRequest;g.overrideMimeType("application/json");b=a(b);d||(b=b+(-1===b.indexOf("?")?"?":"&")+"version=0.6.2");
try{g.open("GET",b,p)}catch(h){e.call(c||this,h);return}g.onload=function(a){4===this.readyState&&(200===a.target.status||0===a.target.status)?e.call(c||this,n,g.responseText):e.call(c||this,Error("'"+b+"' not got, status="+a.target.status))};g.onerror=function(a){e.call(c||this,Error("Error '"+a.target.status+"' downloading "+b))};g.ontimeout=function(){e.call(c||this,Error("Timeout while requiring "+b))};g.send()}}}};C("PENGO.client.igloo.require.staticOps");
window.PENGO.client.igloo.require.staticOps.resolve=function(){function b(c,a,b,e){function d(){t.readyState>=t.HAVE_CURRENT_DATA?(u=p,a.onloaded.call(b||this,t),g(t,l),e&&e()):0<f?(f-=1,v=setTimeout(d,1E3)):t.onerror&&t.onerror()}var t=document.createElement("audio"),v,f=30,u=s,l=function G(){u||(clearTimeout(v),a.onloaded.call(b||this,t),g(t,G),e&&e())};a&&(a.onstart&&(t.onloadstart=function(){a.onstart.call(b||this)}),a.onloaded&&(t.addEventListener("canplaythrough",l,s),v=setTimeout(d,1E3)),a.onerror&&
(t.onerror=function(){a.onerror.call(b||this,Error("Error event has happened downloading resource from '"+c.src+"'"));g(t,l);e&&e()}),a.onabort&&(t.onabort=function(){a.onabort.call(b||this,Error("Abort event has happened downloading resource from '"+c.src+"'"));g(t,l);e&&e()}),a.onprogress&&(t.onprogress=function(c){c.lengthComputable&&a.onprogress.call(b||this,100*(c.loaded/c.total))}));t.setAttribute("preload","auto");t.autobuffer=p;if(Array.isArray(c.src))for(var y in c.src)t.setAttribute("src",
c.src[y]);else t.setAttribute("src",c.src)}function a(c,a,b,e){b&&(b.onstart&&(a.onloadstart=function(){b.onstart.call(e||this,{file:c})}),b.onloaded&&(a.onload=function(d){b.onloaded.call(e||this,{file:c,result:d.target.result});g(a)}),b.onerror&&(a.onerror=function(){b.onerror.call(e||this,{file:c,error:Error("Error event has happened reading local file from '"+src+"'")});g(a)}),b.onabort&&(a.onabort=function(){b.onabort.call(e||this,{file:c,error:Error("Abort event has happened reading local file from '"+
src+"'")});g(a)}),b.onprogress&&(a.onprogress=function(a){a.lengthComputable&&b.onprogress.call(e||this,{file:c,progress:a.loaded/a.total})}))}function g(a,c){a.onloadstart=n;a.onload=n;c&&a.removeEventListener("canplaythrough",c,s);a.onerror=n;a.onabort=n;a.onprogress=n}var d={BINARY_STRING:0,TEXT:1,DATA_URL:2,ARRAY_BUFFER:3},f=s,e=function q(a,c,b,e){if(f===p)setTimeout(function(){q(a,c,b,e)},5);else{f=p;var d=setTimeout(function(){c&&c.onerror&&c.onerror.call(b||this,Error("Timeout happened downloading resource from '"+
a.src+"'"));e&&(e(),e=n);f=s},3E4),g=new Howl({src:Array.isArray(a.src)?a.src:[a.src],ext:Array.isArray(a.ext)?a.ext:[a.ext],onload:function(){clearTimeout(d);c&&c.onloaded&&c.onloaded.call(b||this,g);e&&(e(),e=n);f=s},onloaderror:function(){clearTimeout(d);c&&c.onerror&&c.onerror.call(b||this,Error("Error event happened downloading resource from '"+a.src+"'"));e&&(e(),e=n);f=s}})}},c=async.queue(function(a,c){a.data.cookie&&(document.cookie=a.data.cookie);a.P.call(a.context||this,a.data,a.callbacks,
a.context,c)},20);return{dependencies:n,implementation:{uploadFile:function(a,c,b,e){var d=new XMLHttpRequest;b&&(b.onstart&&(d.onloadstart=function(){b.onstart.call(e||this)}),b.onloaded&&(d.onload=function(g){4===d.readyState&&(200===g.target.status||0===g.target.status)?b.onloaded.call(e||this):b.onerror&&b.onerror.call(e||this,Error("Error event has happened uploading resource '"+a+"' to '"+c+"'"))}),b.onerror&&(d.onerror=function(){b.onerror.call(e||this,Error("Error event has happened uploading resource '"+
a+"' to '"+c+"'"))}),b.onabort&&(d.onabort=function(){b.onabort.call(e||this,Error("Abort event has happened uploading resource '"+a+"' to '"+c+"'"))}),b.onprogress&&(d.upload.onprogress=function(a){a.lengthComputable&&b.onprogress.call(e||this,100*(a.loaded/a.total))}));d.open("POST",c,p);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type",a.type);d.setRequestHeader("X-File-Name",encodeURI(a.name));d.send(a)},downloadStaticRes:function(a,b,e){switch(a.type){case a.resTypes.IMAGE:c.push({P:this.downloadImage,
data:{src:a.src,ext:a.ext,cookie:a.cookie&&a.cookie.add},callbacks:b,context:e},function(){a.cookie&&(document.cookie=a.cookie.remove)});break;case a.resTypes.AUDIO:c.push({P:this.downloadAudio,data:{src:window.Howler?a.src:a.src+(-1===a.src.indexOf("?")?"?":"&")+"yiha="+Math.random(),ext:a.ext,cookie:a.cookie&&a.cookie.add},callbacks:b,context:e},function(){a.cookie&&(document.cookie=a.cookie.remove)})}},downloadImage:function(a,c,b,e){var d=new Image;c&&(c.onstart&&(d.onloadstart=function(){c.onstart.call(b||
this)}),c.onloaded&&(d.onload=function(){c.onloaded.call(b||this,d);g(d);e&&e()}),c.onerror&&(d.onerror=function(){c.onerror.call(b||this,Error("Error event has happened downloading resource from '"+a.src+"'"));g(d);e&&e()}),c.onabort&&(d.onabort=function(){c.onabort.call(b||this,Error("Abort event has happened downloading resource from '"+a.src+"'"));g(d);e&&e()}),c.onprogress&&(d.onprogress=function(a){a.lengthComputable&&c.onprogress.call(b||this,100*(a.loaded/a.total))}));d.src=a.src},downloadAudio:window.Howler?
e:b,downloadFile:function(a,c,b,e,d){var f=new XMLHttpRequest;c&&(c.onstart&&(f.onloadstart=function(){c.onstart.call(b||this)}),c.onloaded&&(f.onload=function(){4===f.readyState&&(200===this.status||0===this.status)?c.onloaded.call(b||this,this.response):c.onerror&&c.onerror.call(b||this,Error("Error event has happened downloading resource from '"+src+"'"));g(f)}),c.onerror&&(f.onerror=function(){c.onerror.call(b||this,Error("Error event has happened downloading resource from '"+src+"'"));g(f)}),
c.onabort&&(f.onabort=function(){c.onabort.call(b||this,Error("Abort event has happened downloading resource from '"+src+"'"));g(f)}),c.onprogress&&(f.onprogress=function(a){a.lengthComputable&&c.onprogress.call(b||this,100*(a.loaded/a.total))}));f.open("GET",a,p);f.setRequestHeader("Content-type","application/x-www-form-urlencoded");f.setRequestHeader("X-Requested-With","XMLHttpRequest");e&&(f.responseType=e);d&&f.setRequestHeader("Cache-control",d);f.send()},localReadingModes:d,readLocalFile:function(c,
b,e,f){var t=new FileReader;a(c,t,e,f);try{switch(b){case d.BINARY_STRING:t.readAsBinaryString(c);break;case d.TEXT:t.readAsText(c);break;case d.DATA_URL:t.readAsDataURL(c);break;case d.ARRAY_BUFFER:t.readAsArrayBuffer(c);break;default:e.onerror&&e.onerror.call(f||this,{file:c,error:Error("Unknown read mode '"+b+"' for '"+c+"'")}),g(t)}}catch(v){e.onerror&&e.onerror.call(f||this,{file:c,error:v}),g(t)}}}}};C("PENGO.client.igloo.require.remove");window.PENGO.client.igloo.require.remove.resolve=function(){return{dependencies:n,implementation:{deleteByName:function(b){b=b.split(".");for(var a,g=0;g<b.length;g++)if(g===b.length-1)a===n?delete window[b[g]]:delete a[b[g]];else if(a=a===n?window[b[g]]:a[b[g]],a===n)break}}}};var H;
H=function(b,a,g,d,f){var e=this,c={"PENGO.client.igloo.require":{"*":{imports:{require:{name:"PENGO.client.igloo.require",version:"*"}},state:this.c.z,g:n}}};this.ra=function(a,b){if(c[a])return c[a][b]||c[a][this.d]};this.sa=function(a,b){if(c[a]){if(c[a][b])return c[a][b].g;if(c[a][this.d])return c[a][this.d].g}};this.G=function(a,b){return c[a]!==n&&(c[a][b]!==n||c[a][this.d]!==n)};this.R=function(a,b){if(this.G(a,b))return c[a][b].state};this.xa=function(a,b){if(this.G(a,b))for(var e in c[a])if(c[a][e]!==b&&
c[a][e].state===this.c.p)return p;return s};this.ha=function(a,e,d){c[a]||(c[a]={});c[a][e]||c[a][this.d]?b&&console.warn("Version '"+e+"' or '"+this.d+"' of dependency '"+a+"' already loaded in static dependencies map."):(c[a][e]=d,c[a][e].state=this.c.z)};this.C=function(a,b,e,d,f){var l,h,k={};for(l in b)k[l]=b[l];for(l in b)if(this.G(b[l].name,b[l].version)){if(!a[b[l].name]){var r=s;a[b[l].name]={version:b[l].version,imports:this.ra(b[l].name,b[l].version).imports};delete k[l];for(h in a[b[l].name].imports)a[a[b[l].name].imports[h].name]||
(r=p,k[h]=a[b[l].name].imports[h]);if(r){this.C(a,k,e,d);return}}}else{e?(e=s,c["PENGO.client.igloo.require"][this.d].g.require.requireJSON(g,function(c,b){if(c)d.call(f||this,c);else{try{this.U(b,s)}catch(g){d.call(f||this,g);return}this.C(a,k,e,d)}},this)):d.call(f||this,Error("'"+b[l].name+"' dependency can't be resolved, '"+b[l].name+"["+b[l].version+"]' is not mapped."));return}d.call(f||this,n,a)};this.ta=function(a){var b,e,d={L:[],f:n};for(b in a)switch(this.R(b,a[b].version)){case this.c.w:break;
case this.c.p:d.f||(d.f={});d.f[b]=a[b];break;case this.c.z:if(this.xa(b,a[b].version))d.f||(d.f={}),d.f[b]=a[b];else{for(e in c[b][a[b].version].js)d.L.push(c[b][a[b].version].url+c[b][a[b].version].js[e]);c[b][a[b].version].state=this.c.p}break;default:return}return d};this.X=function(a,b,e){function d(a,c,b,e){setTimeout(function(){a.X(c,b,e)},100)}var g=this.ta(a);g?0!==g.L.length?c["PENGO.client.igloo.require"][this.d].g.require.requireSerieJS(g.L,n,function(a){a?b.call(e||this,a):g.f?d(this,
g.f,b,e):b.call(e||this)},e):g.f?d(this,g.f,b,e):b.call(e||this):b.call(e||this,Error("Can't get '.js' list to resolve dependencies."))};this.U=function(a,c){var e,d,g;a||m(Error("Static descriptor can't be "+a));a=JSON.parse(a);for(var f in a)if("string"!==typeof f)c===p&&m(Error("Dependence index value '"+f+"' in static descriptor not valid, it must be a String.")),b&&console.warn("WARNING: Dependence index value '"+f+"' in static descriptor not valid, it must be a String. Dependence ignored!."),
delete a[f];else for(e in a[f])if("string"!==typeof e)c===p&&m(Error("Version can't be '"+e+"' in '"+f+"' in static descriptor, it must be a String.")),b&&console.warn("WARNING: Version can't be '"+e+"' in '"+f+"' in static descriptor, it must be a String."),delete a[f][e];else if(a[f][e].url)if("string"!==typeof a[f][e].url)c===p&&m(Error("Property 'url' in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String.")),b&&console.warn("WARNING: Property 'url' in '"+e+"' version of dependency '"+
f+"' in static descriptor must be a String."),delete a[f][e];else if(a[f][e].js)if(a[f][e].js instanceof Array){if(a[f][e].imports)if(a[f][e].imports instanceof Object){g=s;for(d in a[f][e].imports)if("string"!==typeof d)c===p&&m(Error(" Imported element's alias in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String.")),b&&console.warn("WARNING: Imported element's alias in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String."),delete a[f][e],g=p;else if(a[f][e].imports[d]instanceof
Object)if(a[f][e].imports[d].name)if("string"!==typeof a[f][e].imports[d].name)c===p&&m(Error("Property 'name' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String.")),b&&console.warn("WARNING: Property 'name' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String."),delete a[f][e],g=p;else if(a[f][e].imports[d].version)"string"!==typeof a[f][e].imports[d].version&&(c===p&&m(Error("Property 'version' in imported element in '"+
e+"' version of dependency '"+f+"' in static descriptor must be a String.")),b&&console.warn("WARNING: Property 'version' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be a String."),delete a[f][e],g=p);else{c===p&&m(Error("Property 'version' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined."));b&&console.warn("WARNING: Property 'version' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined.");
delete a[f][e];g=p;break}else{c===p&&m(Error("Property 'name' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined."));b&&console.warn("WARNING: Property 'name' in imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined.");delete a[f][e];g=p;break}else{c===p&&m(Error("Imported element in '"+e+"' version of dependency '"+f+"' in static descriptor must be an Object."));b&&console.warn("WARNING: Imported element in '"+
e+"' version of dependency '"+f+"' in static descriptor must be an Object.");delete a[f][e];g=p;break}if(g)continue}else{c===p&&m(Error("Property 'imports' in '"+e+"' version of dependency '"+f+"' in static descriptor must be an Object."));b&&console.warn("WARNING: Property 'imports' in '"+e+"' version of dependency '"+f+"' in static descriptor must be an Object.");delete a[f][e];continue}this.ha(f,e,a[f][e])}else c===p&&m(Error("Property 'js' in '"+e+"' version of dependency '"+f+"' in static descriptor must be an Array.")),
b&&console.warn("WARNING: Property 'js' in '"+e+"' version of dependency '"+f+"' in static descriptor must be an Array."),delete a[f][e];else c===p&&m(Error("Property 'js' in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined.")),b&&console.warn("WARNING: Property 'js' in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined."),delete a[f][e];else c===p&&m(Error("Property 'url' in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined.")),
b&&console.warn("WARNING: Property 'url' in '"+e+"' version of dependency '"+f+"' in static descriptor must be defined."),delete a[f][e]};this.V=function(a,b,d){var g=this;c["PENGO.client.igloo.require"][this.d].g.require.requireJSON(a,function(a,c){if(a)b.call(d||this,a);else{try{c=JSON.parse(c)}catch(e){b.call(d||this,e);return}g.W(c,b,d)}},e)};this.W=function(a,b,e){!a.imports||!(a.imports instanceof Object)?b.call(e||this,Error("Property 'imports' in static descriptor '"+staticJSON+"' must be an Array.")):
this.C({},a.imports,p,function(d,g){d?b.call(e||this,d):this.X(g,function(d){if(d)b.call(e||this,d);else{var f,h;d={};for(f in g)this.R(f,g[f].version)===this.c.p&&(d={},g[f].B=[],this.Y(c["PENGO.client.igloo.require"][this.d].g.require.requireByName(f),d,g[f].B),c[f][g[f].version].g=d);for(f in g){for(h in g[f].B)g[f].B[h](this.S(g[f].imports));c[f][g[f].version].state=this.c.w;c["PENGO.client.igloo.require"][this.d].g.remove.deleteByName(f)}b.call(e||this,n,this.S(a.imports))}},this)},this)};if(!window.PENGO.client.igloo.require||
!window.PENGO.client.igloo.require.require||!window.PENGO.client.igloo.require.remove)d.call(f||this,Error("'PENGO.client.igloo.require' dependency must be loaded because it's a built-in element of Igloo, but it isn't."));else{var k={},q=[],h={};this.Y(window.PENGO.client.igloo.require,k,q,a);h[this.ea]=k;c["PENGO.client.igloo.require"][this.d].g=k;for(var r in q)q[r](h);c["PENGO.client.igloo.require"][this.d].state=this.c.w;k.remove.deleteByName("PENGO.client.igloo.require");k.require.requireJSON(g,
function(a,c){if(a)d.call(f||this,a);else{try{this.U(c,p)}catch(b){d.call(f||this,b);return}d.call(f||this)}},e)}};H.prototype={d:"*",ea:"require",c:{z:"unresolved",p:"resolving",w:"resolved"},Y:function I(a,g,d,f){var e,c;for(c in a)a[c].resolve&&a[c].resolve instanceof Function?(e=a[c].resolve({sto:f}),g[c]=e.implementation,e.dependencies&&d.push(e.dependencies)):(g[c]={},I(a[c],g[c],d))},S:function(b){var a={},g;for(g in b)a[g]=this.sa(b[g].name,b[g].version);return a}};var J;J=function(b){this.plstls=function(a){for(var g in b)a!==n&&b[g].state!==a||console.debug(b[g].id+":"+b[g].state)};C("PENGO.client.apps.igloo.loottuo",this,n)};var K;
K=function(b,a,g){var d=this;this.ya=function(f,e){this.plugins=f||K.prototype.plugins;a.require.require.requireJSON(this.plugins.URL+this.plugins.LOGGER+this.plugins.DESCRIPTOR,function(c,f){if(c)a.util.callback.call(e,this,c);else{try{f=JSON.parse(f)}catch(q){a.util.callback.call(e,this,new a.error.pengoError.StoredPengoError("igloo","pldesc#2"))}b.F(f,d.plugins.URL+d.plugins.LOGGER+d.plugins.STATIC,b.m.URL,function(c,f){c?a.util.callback.call(e,this,c):b.K(f,n,n,function(c){if(c)a.util.callback.call(e,this,
c);else{b.j=g.getService("igloo.logger")[0];var f=a.util.object.countProperties(d.plugins.others),h=s,k;for(k in d.plugins.others)(function(c){a.require.require.requireJSON(d.plugins.URL+c+d.plugins.DESCRIPTOR,function(g,k){if(g)b.j.error(g.message),h||(h=p,a.util.callback.call(e,this,g));else{try{k=JSON.parse(k)}catch(r){a.util.callback.call(e,this,new a.error.pengoError.StoredPengoError("igloo","pldesc#2"))}b.F(k,d.plugins.URL+c+d.plugins.STATIC,b.m.URL,function(c,d){c?(b.j.error(c.message),h||
(h=p,a.util.callback.call(e,this,c))):b.K(d,n,n,function(c){c?(b.j.error(c.message),h||(h=p,a.util.callback.call(e,this,c))):(f--,0===f&&!h&&a.util.callback.call(e,n))})})}})})(d.plugins.others[k])}},this)},this)}},this)}};K.prototype={plugins:{DESCRIPTOR:"/plugin.json",STATIC:"/static.json",URL:"/client/apps/igloo/src/plugins/",LOGGER:"igloo.logger",others:{EVENTS_MANAGER:"igloo.eventsManager",FATAL:"igloo.fatal"}}};var L;
(function(){var b;L=function(a,g){this.t=a;b=g;this.r={}};L.prototype={ma:function(a,g){a||m(new g("igloo:am","appdesc#1",[a]));try{a=JSON.parse(a)}catch(d){m(new b.error.pengoError.PengoError("App descriptor must be a valid JSON",b.error.codes.codes.INVALID_DATA))}a.id?"string"!==typeof a.id&&m(new b.error.pengoError.PengoError("Property 'id' in app descriptor must be a String",b.error.codes.codes.INVALID_TYPE)):m(new b.error.pengoError.PengoError("App descriptor is missing property 'id'",b.error.codes.codes.NOT_FOUND));
a.defInstallation||m(new b.error.pengoError.PengoError("App descriptor is missing property 'defInstallation'",b.error.codes.codes.NOT_FOUND));this.t.A(a.defInstallation);a.defDescriptor?"string"!==typeof a.defDescriptor&&m(new b.error.pengoError.PengoError("Property 'defDescriptor' in app descriptor must be a String",b.error.codes.codes.INVALID_TYPE)):m(new b.error.pengoError.PengoError("App descriptor is missing property 'defDescriptor'",b.error.codes.codes.NOT_FOUND));a.defStatic?"string"!==typeof a.defStatic&&
m(new b.error.pengoError.PengoError("Property 'defStatic' in app descriptor must be a String",b.error.codes.codes.INVALID_TYPE)):m(new b.error.pengoError.PengoError("App descriptor is missing property 'defStatic'",b.error.codes.codes.NOT_FOUND));a.defCompound===n&&m(new b.error.pengoError.PengoError("App descriptor is missing property 'defCompound'",b.error.codes.codes.NOT_FOUND));"boolean"!==typeof a.defCompound&&m(new b.error.pengoError.PengoError("Property 'defCompound' in app descriptor must be boolean",
b.error.codes.codes.INVALID_TYPE));a.plugins?"object"!==typeof a.plugins&&m(new b.error.pengoError.PengoError("Property 'plugins' in app descriptor must be an Object",b.error.codes.codes.INVALID_TYPE)):m(new b.error.pengoError.PengoError("App descriptor is missing property 'plugins'",b.error.codes.codes.NOT_FOUND));for(var f in a.plugins)a.plugins[f].m&&this.t.A(a.plugins[f].installation),a.plugins[f].descriptor&&"string"!==typeof a.plugins[f].descriptor&&m(new b.error.pengoError.PengoError("Property 'descriptor' of plugin "+
f+" in app descriptor must be a String",b.error.codes.codes.INVALID_TYPE)),a.plugins[f].config&&(!a.plugins[f].config instanceof Object&&m(new b.error.pengoError.PengoError("Property 'config' of plugin "+f+" in app descriptor must be an Object",b.error.codes.codes.INVALID_TYPE)),a.plugins[f].config.compound&&"boolean"!==typeof a.plugins[f].config.compound&&m(new b.error.pengoError.PengoError("Property 'config.compound' of plugin "+f+" in app descriptor must be boolean",b.error.codes.codes.INVALID_TYPE)),
a.plugins[f].config.data&&!a.plugins[f].config.data instanceof Object&&m(new b.error.pengoError.PengoError("Property 'config.data' of plugin "+f+" in app descriptor must be an Object",b.error.codes.codes.INVALID_TYPE)));return a},Ja:function(a,g,d){try{a=this.ma(a,b.error.pengoError.StoredPengoError)}catch(f){b.util.callback.call(g,d,f);return}var e=this,c=b.util.object.countProperties(a.plugins),k=s,q,h;for(h in a.plugins)(function(f){a.plugins[f].baseURL?b.require.require.requireJSON(a.plugins[f].baseURL+
(a.plugins[f].descriptor||a.defDescriptor),function(h,t){if(h)k||(k=p,b.util.callback.call(g,d||this,h,{id:a.id,version:a.version}));else{try{t=JSON.parse(t)}catch(v){m(new StoredPengoError("igloo","pldesc#2"))}t.src&&a.plugins[f].src&&(t.src=b.util.object.merge(a.plugins[f].src,t.src));t.res&&a.plugins[f].res&&(t.res=b.util.object.merge(a.plugins[f].res,t.res));e.t.F(t,a.plugins[f].baseURL+(a.plugins[f]["static"]||a.defStatic),a.plugins[f].installation||a.defInstallation,function(h,t){h?k||(k=p,
b.util.callback.call(g,d||this,h,{id:a.id,version:a.version})):(a.plugins[f].config&&(q=a.plugins[f].config.compound!==n?a.plugins[f].config.compound:a.defCompound),e.t.K(t,a.plugins[f].config?{compound:q,data:a.plugins[f].config.data}:n,{id:a.id,appkey:a.appkey,version:a.version,type:a.type},function(f){f?k||(k=p,b.util.callback.call(g,d||this,f,{id:a.id,version:a.version})):(c--,0===c&&!k&&(e.r[a.id]=a,b.util.callback.call(g,d||this,n,{id:a.id,version:a.version})))}))})}}):(c--,0===c&&!k&&(e.r[a.id]=
a,b.util.callback.call(g,d||this,n,{id:a.id,version:a.version})))})(h)}}})();var M,O;
O=function(b){function a(){var a=[];a.push(function(a){g.H(g.url+"start",g.a.start[0],function(){a()})});f.forEach(function(c){(function(c){a.push(function(a){d=g.a[c].length;0===d?a():function(c){g.a[c].forEach(function(b){g.H(g.url+c,b,function(){d--;0===d&&a()})})}(c)})})(c)});async.I(a,function(a){a&&console.error("Error "+a+" happens sending test results to server.");g.H(g.url+"end",g.a.end[0],function(){})})}var g=this,d=0,f="plugin file test pass fail pending file_end plugin_end".split(" ");b&&
(this.Ea=b,this.url="/itests/",this.a={start:[],Ba:[],file:[],test:[],Aa:[],fail:[],n:[],qa:[],Ca:[],end:[]},b.on("start",function(a){g.a.start.push(a)}),b.on("plugin",function(a){g.a.Ba.push(a)}),b.on("file",function(a){g.a.file.push(a)}),b.on("test",function(a){g.a.test.push(a)}),b.on("pass",function(a){g.a.Aa.push(a)}),b.on("fail",function(a){a.reason instanceof Error&&(a.reason={message:a.reason.message,stack:a.reason.stack});g.a.fail.push(a)}),b.on("pending",function(a){g.a.n.push(a)}),b.on("file_end",
function(a){g.a.qa.push(a)}),b.on("plugin_end",function(a){g.a.Ca.push(a)}),b.on("end",function(b){g.a.end.push(b);a()}))};
O.prototype={H:function(b,a,g,d,f){var e=this,c=new XMLHttpRequest;c.onload=function(){var a=n;switch(c.status){case 0:case 200:try{a=JSON.parse(c.responseText)}catch(h){console.error("Error '"+h+"' while parsing request response to '"+b+"'")}break;default:console.error("Status "+c.status+" while posting to '"+b+"'")}g.call(e,a,d,f)};c.onerror=function(a){console.error("Error '"+a+"' while posting to '"+b+"'");g.call(e,n,d,f)};c.ontimeout=function(){console.error("Timeout while posting to '"+b+"'");
g.call(e,n,d,f)};try{c.open("POST",b,p),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.send(JSON.stringify(a))}catch(k){console.error("Error"+k+" while posting to "+b+"'"),g.call(e,n,d,f)}}};var Q;
Q=function(b){function a(a){e.plugins[a.id[1]]||(e.plugins[a.id[1]]={},e.plugins[a.id[1]].a={})}function g(c){a(c);e.plugins[c.id[1]].a[c.id[2]]||(e.plugins[c.id[1]].a[c.id[2]]={total:0,u:[],n:[],s:[]})}function d(a){g(a);e.plugins[a.id[1]].a[a.id[2]][a.id[3]]||(e.plugins[a.id[1]].a[a.id[2]][a.id[3]]={})}var f=this,e=this.Ka={plugins:{}};b&&(this.Ea=b,b.on("start",function(){e.start=(new Date).getTime()}),b.on("plugin",function(c){a(c);e.plugins[c.id[1]].start=(new Date).getTime()}),b.on("file",function(a){g(a);
e.plugins[a.id[1]].a[a.id[2]].start=(new Date).getTime()}),b.on("test",function(a){d(a);e.plugins[a.id[1]].a[a.id[2]][a.id[3]].start=(new Date).getTime()}),b.on("pass",function(a){d(a);a.duration=(new Date).getTime()-e.plugins[a.id[1]].a[a.id[2]][a.id[3]].start;e.plugins[a.id[1]].a[a.id[2]].total++;e.plugins[a.id[1]].a[a.id[2]].u.push(a)}),b.on("fail",function(a){d(a);e.plugins[a.id[1]].a[a.id[2]].total++;e.plugins[a.id[1]].a[a.id[2]].s.push(a)}),b.on("pending",function(a){d(a);e.plugins[a.id[1]].a[a.id[2]].total++;
e.plugins[a.id[1]].a[a.id[2]].n.push(a)}),b.on("file_end",function(a){g(a);e.plugins[a.id[1]].end=(new Date).getTime();e.plugins[a.id[1]].a[a.id[2]].duration=e.plugins[a.id[1]].a[a.id[2]].end-e.plugins[a.id[1]].a[a.id[2]].start}),b.on("plugin_end",function(b){a(b);e.plugins[b.id[1]].end=(new Date).getTime();e.plugins[b.id[1]].duration=e.plugins[b.id[1]].end-e.plugins[b.id[1]].start}),b.on("end",function(){e.end=(new Date).getTime();e.duration=e.end-e.start;f.oa()}),this.ca={za:"\u2713",Ra:"\u2716",
Qa:"\u2024",Ia:"-"},this.na={pass:90,fail:31,"bright pass":92,"bright fail":91,"bright yellow":93,pending:36,plugin:0,"error title":0,"error message":31,"error stack":90,checkmark:32,fast:90,medium:33,slow:31,green:32,light:90,"diff gutter":90,"diff added":42,"diff removed":41})};
Q.prototype={color:function(b,a){return!Q.prototype.Xa?a:"\u001b["+Q.prototype.na[b]+"m"+a+"\u001b[0m"},oa:function(){var b=this.Ka,a=this,g;b.Da||(console.log(),b.Da=p,Object.keys(b.plugins).forEach(function(d){0===Object.keys(b.plugins[d].a).length?(g=a.color("bright pass"," ")+a.color("green","Plugin %s has no test defined."),console.log(g,d)):Object.keys(b.plugins[d].a).forEach(function(f){0<b.plugins[d].a[f].u.length&&(g=a.color("bright pass"," ")+a.color("green","Plugin %s file %s.js %d passing"),
console.log(g,d,f,b.plugins[d].a[f].u.length),g=a.color("bright pass","  %s) %s Duration: %d.\n"),b.plugins[d].a[f].u.forEach(function(b){console.log(g,a.ca.za,b.id[3],b.duration)}));0<b.plugins[d].a[f].n.length&&(g=a.color("pending"," ")+a.color("pending","Plugin %s file %s.js %d pending"),console.log(g,d,f,b.plugins[d].a[f].n.length),g=a.color("pending","  %s) %s\n"),b.plugins[d].a[f].n.forEach(function(b){console.log(g,a.ca.Ia,b.id[3])}));0<b.plugins[d].a[f].s.length&&(g=a.color("fail"," ")+a.color("fail",
"Plugin %s  file %s.js %d failing"),console.log(g,d,f,b.plugins[d].a[f].s.length),a.list(b.plugins[d].a[f].s),console.log());console.log()})}))},list:function(b){var a,g,d,f,e,c;console.error();c=this.color("error title","  %s) %s:\n")+this.color("error message","     %s")+this.color("error stack","\n%s");b.forEach(function(b,q){f=b.reason;a="string"===typeof f?f:f.message||"";g=f.stack||a;d=g.indexOf(a)+a.length;e=g.slice(0,d);b.Va&&(e="Uncaught "+e);g=g.slice(d?d+1:d).replace(/^/gm,"  ");console.log(c,
q+1,b.id[3],e,g)})}};(function(){var b,a,g,d,f,e={};M=function(c,k,q,h,r,w){function t(a,b,e){var d;d=a.split("/")[0];(function(a){u[d][a].Q[b]=function(h){try{e?u[d][a].l.ka(v(function(k){k?(f.b("fail",{id:[c,d,a,"beforeEach"],reason:k}),k.code!==g.o&&h(n)):function(b,l){try{f.b("test",{id:[c,d,b,l]}),z(u[d][a].l.timeout||6E4,e,this,v(function(a){try{u[d][b].l.N(v(function(e){if(e)f.b("fail",{id:[c,d,b,l],reason:e}),e.code!==g.o&&h(n);else{switch(a){case n:f.b("pass",{id:[c,d,b,l]});break;default:f.b("fail",{id:[c,d,
b,l],reason:a})}(!a||a.code!==g.o)&&h(n)}}))}catch(e){f.b("fail",{id:[c,d,b,"afterEach"],reason:k}),h(n)}}))}catch(A){u[d][b].l.N(function(a){a?f.b("fail",{id:[c,d,b,"afterEach"],reason:A}):f.b("fail",{id:[c,d,b,l],reason:A});h(n)})}}(a,b)})):(f.b("pending",{id:[c,d,a,b]}),h(n))}catch(k){f.b("fail",{id:[c,d,a,"beforeEach"],reason:k}),h(n)}}})(a.split("/")[1])}function v(a){var b=s;return function(c){b?a(Error("Calling done callback twice",g.o)):(b=p,a(c))}}function z(a,b,c,e){var d=setTimeout(function(){e(Error("Test is timeOuted."))},
a);b.call(c,function(){clearTimeout(d);e.apply(c,arguments)})}var u={},l=Object.keys(k.plugins),y;d=r.ua("igloo.logger")[0];f=r.ua("igloo.eventsManager")[0];b=h.util.object;a=h.error.pengoError.PengoError;g=h.error.codes.codes;this.timeout=6E4;e[c]||(e[c]=-1);q={start:"start",plugin:"plugin",file:"file",test:"test",fail:"fail",pass:"pass",pending:"pending",file_end:"file_end",plugin_end:"plugin_end",end:"end"};try{f.Ta(q)}catch(B){d.debug(B)}new Q(f);new O(f);this.pa=function(a,b,e){var d=[];Object.keys(a.src).forEach(function(e){a.src[e].Z&&
a.src[e].Z instanceof Function&&function(e,k,l,q){d.push(function(d){a[q]={};a[q].state=2;a[q].Q={};a[q].l={assert:chai.assert,ja:function(a){a()},ka:function(a){a()},ia:function(a){a()},N:function(a){a()}};e(b+"/"+q,t,r,k,l||h,a[q].l);f.b("file",{id:[c,b,q]});try{a[q].l.ja(v(function(e){if(e){f.b("fail",{id:[c,b,q,"beforeAll"],reason:e});f.b("file_end",{id:[c,b,q]});if(e.code===g.o)return;d()}async.I(a[q].Q,function(e,h){a[q].state=1;a[q].a=h;try{a[q].l.ia(v(function(a){a?(f.b("fail",{id:[c,b,q,
"afterAll"],reason:a}),f.b("file_end",{id:[c,b,q],reason:a}),a.code!==g.o&&d()):(f.b("file_end",{id:[c,b,q]}),d())}))}catch(k){f.b("fail",{id:[c,b,q,"afterAll"],reason:k}),f.b("file_end",{id:[c,b,q],reason:k}),d()}})}))}catch(A){f.b("fail",{id:[c,b,q,"beforeAll"],reason:A}),f.b("file_end",{id:[c,b,q]}),d()}})}(a.src[e].Z,a.e,a.imports,e)});async.I(d,function(){e&&e.call(this)})};this.execute=function(d,q){var r=this,t=[];if(1===e[c])d&&d.call(q||this);else{e[c]=1;f.b("start",{id:[c]});for(var v=0;v<
l.length;v++)y=k.plugins[l[v]].test,function(e,d){try{t.push(function(k){async.Ya([function(c){d?b.isObject(d)?Array.isArray(d.files)?b.isObject(d.Ha)?c():(u[l[e]]={src:new a("If defined, plugin's '"+l[e]+"' test settings must be a defined Object",g.M),e:n},c(1)):(u[l[e]]={src:new a("If defined, plugin's '"+l[e]+"' test files must be an Array Object",g.M),e:n},c(1)):(u[l[e]]={src:new a("If defined, plugin's '"+l[e]+"' test info must be an Object",g.Ma),e:n},c(1)):(u[l[e]]={src:n},c(1))},function(b){h.require.require.requireSerieJS(d.files,
n,function(c){c?(u[l[e]]={src:new a("Error "+c.message+" in plugin '"+l[e]+"' require "+d.files,g.v),e:n,imports:n},b(1)):b()})},function(c){d.imports===n?c():b.isObject(d.imports)?w.W(d,function(b,f){u[l[e]]=b?{src:new a("Error "+b.message+" in plugin '"+l[e]+"' require "+d.files,g.v),e:n,imports:n}:b?{src:new a("Error "+b.message+" in plugin '"+l[e]+"' require "+d.files,g.v),e:n,imports:n}:{src:h.require.require.requireByName(d.namespace),e:d.Ha,imports:f};c()}):(u[l[e]]={src:new a("If defined, plugin's '"+
l[e]+"' imports must be a defined Object",g.M),e:n},c(1))},function(b){!d.aux||Array.isArray(d.aux)&&0===d.aux.length?b():h.require.require.requireSerieJS(d.aux,n,function(c){c&&(u[l[e]]={src:new a("Error "+c.message+" in plugin '"+l[e]+"' require "+d.aux,g.v),e:n,imports:n});b()})}],function(a){f.b("plugin",{id:[c,l[e]]});a?(u[l[e]].state=0,k(),f.b("plugin_end",{id:[c,l[e]]})):b.isObject(u[l[e]].src)?r.pa(u[l[e]],l[e],function(a){a&&(u[l[e]].state=0,m(a));u[l[e]].state=1;try{k(),f.b("plugin_end",
{id:[c,l[e]]})}catch(b){u[l[e]].state=0,m(b)}}):(u[l[e]].state=0,k(),f.b("plugin_end",{id:[c,l[e]]}))})})}catch(k){u[l[e]].state=0,m(k)}}(v,y);async.I(t,function(a){d&&d.call(q||this,a);try{f.b("end",{id:[c]})}catch(b){m(b)}})}}}})();C("PENGO.client.apps.igloo.igloo");
(function(){function b(b,c){b||m(new c("igloo","pldesc#1",[b]));b.id?"string"!==typeof b.id&&m(new c("igloo","pldesc:id#2")):m(new c("igloo","pldesc:id#1"));b.provides?Array.isArray(b.provides)||m(new c("igloo","pldesc:provides#2",[b.id])):m(new c("igloo","pldesc:provides#1",[b.id]));b.consumes?b.consumes instanceof Array||m(new c("igloo","pldesc:consumes#2",[b.id])):m(new c("igloo","pldesc:consumes#1",[b.id]));b.config&&"object"!==typeof b.config&&m(new c("igloo","pldesc:cfg",[b.id]));b.activator?
"string"!==typeof b.activator&&m(new c("igloo","pldesc:activator#2",[b.id])):m(new StoredPengoErroloadTestr("igloo","pldesc:activator#1",[b.id]));b.src||m(new c("igloo","pldesc:src",[b.id]));b.src.baseURL?"string"!==typeof b.src.baseURL&&m(new c("igloo","pldesc:src:baseURL#2",[b.id])):m(new c("igloo","pldesc:src:baseURL#1",[b.id]));b.src.js||m(new c("igloo","pldesc:src:js",[b.id]));a(b.id,b.src.js,"src.js",c);b.src.text&&"string"!==typeof b.src.text&&m(new StoredPengloadTestoError("igloo","pldesc:src:text",
[b.id]));b.res&&(b.res.baseURL?"string"!==typeof b.res.baseURL&&m(new c("igloo","pldesc:res:baseURL#2",[b.id])):m(new c("igloo","pldesc:res:baseURL#1",[b.id])),b.res.css&&a(b.id,b.res.css,"res.css"),b.res.template&&"string"!==typeof b.res.template&&m(new c("igloo","pldesc:res:template",[b.id])));return b}function a(a,b,d,f){var g=["loadMode-dwm","loadMode"],r;for(r in g)b[g[r]]?("compiled"!==b[g[r]]&&("notCompiled"!==b[g[r]]&&"built-in"!==b[g[r]])&&m(new f("igloo","pldesc:lm#2",[d,a])),"compiled"===
b[g[r]]?b.compiled?"string"!==typeof b.compiled&&m(new f("igloo","pldesc:lm#4",[d,a])):m(new f("igloo","pldesc:lm#3",[d,a,d])):"notCompiled"===b[g[r]]&&(b.notCompiled?Array.isArray(b.notCompiled)||m(new f("igloo","pldesc:lm#6",[d,a])):m(new f("igloo","pldesc:lm#5",[d,a,d])))):m(new f("igloo","pldesc:lm#1",[a,d+".loadMode-dwm'"]))}var g=window.PENGO.client.apps.igloo.igloo,d,f=n;window.addEventListener("load",function(){f===n&&(f=document.createElement("div"),f.style.position="absolute",f.style.top=
"calc(50% - 10px)",f.style.left="calc(50% - 100px)",f.style.textAlign="center",f.style.width="200px",f.style.height="20px",f.style.font="MyriadPro,Arial,Helvetica,sans-serif",f.style.fontSize="13px",f.innerHTML="Loading",document.body.appendChild(f))},s);g.Igloo=function c(a){var q=this,h={},r,w,t,v,z,u=a.staticMap,l=a.app,y=JSON.parse(a.dwm)===p,B=a["static"],G=a.corePluginsLoader||"/client/apps/igloo/src/corePluginsLoader.json",P=a.mode;a=a.sto||{enabled:s};this.out=new J(h);this.j=n;r=new H(y,
a,u,function(a){a||r.V(B,function(a,k){if(!a){d=k;try{F(d.error.pengoError.storage,d.error.codes.codes)}catch(u){return}w=new d.servicesManager.servicesManager.ServicesManager;t=new K(this,d,w);z=new L(this,d);var B=function(a,b,c){function f(){a.src&&a.src.template?d.require.require.requireTemplate(a.src.baseURL+a.src.template,function(a,f){a?(q.j.error(a.message),d.util.callback.call(b,c||this,a)):(h=f,d.util.callback.call(g,c||this))},c||this):d.util.callback.call(g,c||this)}function g(){if(a.res&&
a.res.css){var f;"compiled"===a.res.css.loadMode?f=a.res.css.compiled:"notCompiled"===a.res.css.loadMode&&(f=a.res.css.notCompiled);d.require.require.requireCSS(a.res.baseURL+f)}d.util.callback.call(b,c||this,n,h)}var h;(function(){function g(){var h=[],k;for(k in a.src.js.notCompiled)h.push(a.src.baseURL+a.src.js.notCompiled[k]);d.require.require.requireSerieJS(h,n,function(a){a?(q.j.error(a.message),d.util.callback.call(b,c||this,a)):d.util.callback.call(f,c||this)},c||this)}function h(){d.require.require.requireJS(a.src.baseURL+
a.src.js.compiled,n,function(a){a?(q.j.error(a.message),d.util.callback.call(b,c||this,a)):d.util.callback.call(f,c||this)},c||this)}"compiled"===a.src.js.loadMode?h():"notCompiled"===a.src.js.loadMode?g():d.util.callback.call(f,c||this)})()},R=function A(a,b,c){"string"===typeof b&&(b=d.require.require.requireByName(b));for(var f in b)b[f].resolve?(a[f]=b[f].resolve(c,a),delete b[f]):b[f]instanceof Object&&(!Array.isArray(b[f])&&!(b[f]instanceof Function))&&(a[f]={},A(a[f],b[f],c))},N=function(a,
b,c,f,k){var l;a.src.js.autoRequires&&(l={},R(l,a.activator.substring(0,a.activator.lastIndexOf(".")),b));b={id:a.id,e:a.config,h:d.require.require.requireByName(a.activator).activator(b,l),Sa:a.provides,Pa:a.consumes,Fa:new d.servicesManager.pluginServicesManager.PluginServicesManager(a.id,w,a),La:c,da:n};a.res&&a.res.text&&(b.da=a.res.baseURL+a.res.text);d.require.remove.deleteByName(a.activator);try{var q=d.error.pengoError.StoredPengoError;"object"!==typeof b&&m(new q("igloo","ispl",[b]));b.checked||
(b.h||m(new q("igloo","ispl:act#1",[b.id])),"object"!==typeof b.h&&m(new q("igloo","ispl:act#2",[b.id])),(!b.h.start||!(b.h.start instanceof Function))&&m(new q("igloo","ispl:act#3",[b.id])),(!b.h.stop||!(b.h.stop instanceof Function))&&m(new q("igloo","ispl:act#4",[b.id])),b.checked=p)}catch(r){this.j.error(r.message);d.util.callback.call(f,k,r);return}b.state=g.Igloo.prototype.c.k;h[b.id]=b;d.util.callback.call(f,k||this,n,b.id)};this.F=function(a,c,f,k,l){if("string"!==typeof f)d.util.callback.call(k,
l||this,new d.error.pengoError.StoredPengoError("igloo","plinstall#1"));else{try{this.A(f)}catch(q){d.util.callback.call(k,l||this,q);return}try{a=b(a,d.error.pengoError.StoredPengoError)}catch(t){d.util.callback.call(k,l,t);return}h[a.id]?d.util.callback.call(k,l||this,new d.error.pengoError.StoredPengoError("igloo","plinstall#3",[a.id])):r.V(c,function(b,c){b?d.util.callback.call(k,l||this,new d.error.pengoError.StoredPengoError("igloo","plinstall#4",[b,a.id])):f===g.Igloo.prototype.m.URL?B(a,function(b,
f){b?d.util.callback.call(k,l||this,new d.error.pengoError.StoredPengoError("igloo","plinstall#5",[b.message,a.id])):N(a,c,f,k,l||this)},l):N(a,c,n,k,l||this)},l)}};this.Wa=function(a,b,f){h[a]?h[a].state===c.c.k?(delete h[a],d.util.callback.call(b,f||this,n,a)):d.util.callback.call(b,f||this,new d.error.pengoError.StoredPengoError("igloo","pluninstall#2",[a,c.c.k,h[a].state])):d.util.callback.call(b,f||this,new d.error.pengoError.StoredPengoError("igloo","pluninstall#1",[a]))};this.K=function(a,
b,c,f,k){var l=n;if(h[a]){if(b){if(b.compound===n||!b.data===n){d.util.callback.call(f,k||this,new d.error.pengoError.StoredPengoError("igloo","plstart#2",[a]));return}l=d.util.object.merge(b.data&&b.data["default"]||b.data||{},b.data&&b.data[P],p);l=b.compound?d.util.object.merge(l,h[a].e):l}if(h[a].state===g.Igloo.prototype.c.k){h[a].state=g.Igloo.prototype.c.fa;try{_.isEmpty(l)&&(l=h[a].e),h[a].h.start(h[a].Fa,{config:l,templates:h[a].La,textsURL:h[a].da},y,c),h[a].state=g.Igloo.prototype.c.q}catch(q){h[a].state=
g.Igloo.prototype.c.k;d.util.callback.call(f,k||this,new d.error.pengoError.StoredPengoError("igloo","plstart#4",[q.message,a]));return}d.util.callback.call(f,k||this)}else d.util.callback.call(f,k||this,new d.error.pengoError.StoredPengoError("igloo","plstart#3",[a,g.Igloo.prototype.c.k,h[a].state]))}else d.util.callback.call(f,k||this,new d.error.pengoError.StoredPengoError("igloo","plstart#1",[a]))};this.Ua=function(a,b,f){if(h[a])if(h[a].state===c.c.q){h[a].state=c.c.ga;try{h[a].h.stop(),h[a].state=
c.c.k}catch(g){h[a].state=c.c.q;d.util.callback.call(b,f||this,g);return}d.util.callback.call(b,f||this)}else d.util.callback.call(b,f||this,new d.error.pengoError.StoredPengoError("igloo","plstop#2",[a,c.c.q,h[a].state]));else d.util.callback.call(b,f||this,new d.error.pengoError.StoredPengoError("igloo","plstop#1",[a]))};d.require.require.requireJSON(G,function(a,b){a&&m(new d.error.pengoError.StoredPengoError("igloo","appdesc",[a.message]));try{b=JSON.parse(b)}catch(c){m(new d.error.pengoError.StoredPengoError("igloo",
"appdesc",[c.message]))}t.ya(b,function(a){a&&m(new d.error.pengoError.StoredPengoError("igloo","cpl",[a.message]));l&&d.require.require.requireJSON(l,function(a,b){a&&m(new d.error.pengoError.StoredPengoError("igloo","appdesc",[a.message]));z.Ja(b,function(a,b){var c;c=b.id;window.PENGO.version=b.version;f!==n?document.body.removeChild(f):f=null;a&&m(new d.error.pengoError.StoredPengoError("igloo","la",[a.message,c]));!a&&z.r[c].test&&(v=new M(c,z.r[c],0,d,w,r),v.execute(function(){}))})})})})}},
this)},this)};g.Igloo.prototype={m:{Na:"object",URL:"url"},c:{k:"installed",fa:"starting",q:"started",ga:"stopping"},A:function(a){var b=s;Object.keys(g.Igloo.prototype.m).forEach(function(d){g.Igloo.prototype.m[d]===a&&(b=p)});b||m(new d.error.pengoError.StoredPengoError("igloo","plinstall#2",[a]))}}})();C("PENGO.client.apps.igloo.plugins.igloo.logger.activator");
(function(){var b,a,g;window.PENGO.client.apps.igloo.plugins.igloo.logger.activator.activator=function(d){return{start:function(f,e){b=f;a||(a=d.log.logger.getInstance(),g={functions:{setSilent:a.setSilent,addTransport:a.addTransport,removeTransport:a.removeTransport,debug:a.debug,info:a.info,warn:a.warn,error:a.error,sec:a.sec,fatal:a.fatal},properties:{}});a.setConfig(e.config);b.register("igloo.logger",g)},stop:function(){g&&b.unregister("igloo.logger",service)}}}})();})();
